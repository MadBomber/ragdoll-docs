
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../search-analytics/">
      
      
        <link rel="next" href="../testing/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Security Considerations - Ragdoll Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#security-considerations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ragdoll Documentation" class="md-header__button md-logo" aria-label="Ragdoll Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ragdoll Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Security Considerations
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ragdoll Documentation" class="md-nav__button md-logo" aria-label="Ragdoll Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ragdoll Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ragdoll Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../background-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Background Processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../database-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Production Deployment Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../document-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../embedding-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment-variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment Variables Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extending the System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../file-uploads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Upload System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation &amp; Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Integration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata-schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata Schemas
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring &amp; Analytics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-modal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Modal Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance Tuning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search &amp; Analytics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#production-security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Production Security Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Security Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Security Architecture Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Data Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryption-at-rest" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption at Rest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encryption at Rest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      Database Encryption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-storage-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage Encryption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-management" class="md-nav__link">
    <span class="md-ellipsis">
      Key Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-in-transit" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption in Transit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encryption in Transit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tlsssl-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      TLS/SSL Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-communication-security" class="md-nav__link">
    <span class="md-ellipsis">
      API Communication Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Access Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Access Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-key-management" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-based-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Token-Based Authentication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#role-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Role-Based Access Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-upload-security" class="md-nav__link">
    <span class="md-ellipsis">
      File Upload Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Upload Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-validation" class="md-nav__link">
    <span class="md-ellipsis">
      File Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-file-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Secure File Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-security" class="md-nav__link">
    <span class="md-ellipsis">
      API Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-security" class="md-nav__link">
    <span class="md-ellipsis">
      Database Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-security" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-protection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Data Protection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm-provider-security" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Provider Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Provider Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-key-protection" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Protection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      Data Privacy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compliance" class="md-nav__link">
    <span class="md-ellipsis">
      Compliance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compliance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdpr-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      GDPR Compliance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-auditing" class="md-nav__link">
    <span class="md-ellipsis">
      Security Auditing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Security Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threat-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Threat Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-security-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Production Security Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Security Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-deployment-security-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-Deployment Security Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regular-security-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      Regular Security Maintenance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#production-security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Production Security Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Security Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Security Architecture Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Data Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryption-at-rest" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption at Rest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encryption at Rest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      Database Encryption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-storage-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage Encryption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-management" class="md-nav__link">
    <span class="md-ellipsis">
      Key Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-in-transit" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption in Transit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encryption in Transit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tlsssl-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      TLS/SSL Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-communication-security" class="md-nav__link">
    <span class="md-ellipsis">
      API Communication Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Access Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Access Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-key-management" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-based-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Token-Based Authentication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#role-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Role-Based Access Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-upload-security" class="md-nav__link">
    <span class="md-ellipsis">
      File Upload Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Upload Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-validation" class="md-nav__link">
    <span class="md-ellipsis">
      File Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-file-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Secure File Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-security" class="md-nav__link">
    <span class="md-ellipsis">
      API Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-security" class="md-nav__link">
    <span class="md-ellipsis">
      Database Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-security" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-protection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Data Protection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm-provider-security" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Provider Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Provider Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-key-protection" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Protection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      Data Privacy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compliance" class="md-nav__link">
    <span class="md-ellipsis">
      Compliance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compliance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdpr-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      GDPR Compliance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-auditing" class="md-nav__link">
    <span class="md-ellipsis">
      Security Auditing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Security Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threat-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Threat Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-security-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Production Security Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Security Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-deployment-security-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-Deployment Security Checklist
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regular-security-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      Regular Security Maintenance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="security-considerations">Security Considerations</h1>
<h2 id="production-security-best-practices">Production Security Best Practices</h2>
<p>Ragdoll processes sensitive documents and integrates with external LLM APIs, requiring comprehensive security measures. This guide covers data protection, access control, API security, and compliance considerations for production deployments.</p>
<h3 id="security-architecture-overview">Security Architecture Overview</h3>
<pre><code class="language-mermaid">flowchart TD
    A[Client Application] --&gt;|HTTPS/TLS| B[Ragdoll]
    B --&gt;|Encrypted Connection| C[PostgreSQL + pgvector]
    B --&gt;|API Keys + TLS| D[LLM Providers]
    B --&gt;|Encrypted Storage| E[File Storage]

    subgraph &quot;Security Layers&quot;
        F[Input Validation]
        G[Authentication]
        H[Authorization]
        I[Encryption]
        J[Audit Logging]
    end

    B --&gt; F
    B --&gt; G
    B --&gt; H
    B --&gt; I
    B --&gt; J
</code></pre>
<h2 id="data-protection">Data Protection</h2>
<h3 id="encryption-at-rest">Encryption at Rest</h3>
<h4 id="database-encryption">Database Encryption</h4>
<pre><code class="language-sql">-- PostgreSQL encryption configuration
-- Enable transparent data encryption (TDE)
ALTER SYSTEM SET ssl = on;
ALTER SYSTEM SET ssl_cert_file = '/path/to/server.crt';
ALTER SYSTEM SET ssl_key_file = '/path/to/server.key';
ALTER SYSTEM SET ssl_ca_file = '/path/to/ca.crt';

-- Enable encryption for specific tablespaces
CREATE TABLESPACE encrypted_space 
  LOCATION '/encrypted/data' 
  WITH (encryption_key_id = 'your-key-id');

-- Move sensitive tables to encrypted tablespace
ALTER TABLE ragdoll_documents SET TABLESPACE encrypted_space;
ALTER TABLE ragdoll_embeddings SET TABLESPACE encrypted_space;
</code></pre>
<h4 id="file-storage-encryption">File Storage Encryption</h4>
<pre><code class="language-ruby"># Shrine configuration with encryption
class DocumentUploader &lt; Shrine
  plugin :encryption, algorithm: 'aes-256-gcm'

  Attacher.validate do
    validate_max_size 50.megabytes
    validate_mime_type %w[application/pdf text/plain image/jpeg image/png]
    validate_extension %w[pdf txt jpg jpeg png docx]
  end

  # Encrypt files before storage
  process(:store) do |io, context|
    if context[:record].sensitive?
      encrypted_io = encrypt_file(io)
      [encrypted_io, { encryption: true }]
    else
      io
    end
  end

  private

  def encrypt_file(io)
    require 'openssl'

    cipher = OpenSSL::Cipher.new('aes-256-gcm')
    cipher.encrypt

    key = ENV['FILE_ENCRYPTION_KEY'] || raise('FILE_ENCRYPTION_KEY not set')
    iv = cipher.random_iv

    cipher.key = key[0..31]  # 32 bytes for AES-256
    cipher.iv = iv

    encrypted_data = cipher.update(io.read) + cipher.final
    auth_tag = cipher.auth_tag

    # Prepend IV and auth tag to encrypted data
    combined_data = iv + auth_tag + encrypted_data
    StringIO.new(combined_data)
  end
end
</code></pre>
<h4 id="key-management">Key Management</h4>
<pre><code class="language-ruby"># Secure key management configuration
class KeyManager
  def self.setup_encryption_keys
    # Use environment-specific key derivation
    master_key = ENV['MASTER_ENCRYPTION_KEY'] || 
                 raise(SecurityError, 'MASTER_ENCRYPTION_KEY required')

    # Derive application-specific keys
    {
      database_key: derive_key(master_key, 'database'),
      file_encryption_key: derive_key(master_key, 'files'),
      api_signing_key: derive_key(master_key, 'api')
    }
  end

  private

  def self.derive_key(master_key, purpose)
    require 'openssl'

    OpenSSL::PKCS5.pbkdf2_hmac(
      master_key,
      purpose,  # Use purpose as salt
      10_000,   # Iterations
      32,       # Key length (256 bits)
      OpenSSL::Digest::SHA256.new
    )
  end
end
</code></pre>
<h3 id="encryption-in-transit">Encryption in Transit</h3>
<h4 id="tlsssl-configuration">TLS/SSL Configuration</h4>
<pre><code class="language-ruby"># Database connection with SSL
Ragdoll::Core.configure do |config|
  config.database_config = {
    adapter: 'postgresql',
    database: 'ragdoll_production',
    username: 'ragdoll',
    password: ENV['DATABASE_PASSWORD'],
    host: 'db.example.com',
    port: 5432,
    sslmode: 'require',           # Require SSL connection
    sslcert: '/path/to/client.crt',
    sslkey: '/path/to/client.key',
    sslrootcert: '/path/to/ca.crt'
  }
end
</code></pre>
<h4 id="api-communication-security">API Communication Security</h4>
<pre><code class="language-ruby"># Secure HTTP client configuration
class SecureAPIClient
  def initialize
    @http_client = Faraday.new do |conn|
      conn.use :ssl, {
        verify: true,
        ca_file: '/etc/ssl/certs/ca-certificates.crt',
        version: 'TLSv1_2'  # Minimum TLS version
      }

      conn.request :retry, {
        max: 3,
        retry_statuses: [429, 500, 502, 503, 504]
      }

      conn.response :json
      conn.adapter Faraday.default_adapter
    end
  end

  def make_request(url, headers = {})
    secure_headers = headers.merge({
      'User-Agent' =&gt; 'Ragdoll/1.0',
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    })

    @http_client.post(url, secure_headers)
  end
end
</code></pre>
<h2 id="access-control">Access Control</h2>
<h3 id="authentication-patterns">Authentication Patterns</h3>
<h4 id="api-key-management">API Key Management</h4>
<pre><code class="language-ruby"># Secure API key configuration
class APIKeyManager
  REQUIRED_KEYS = %w[
    OPENAI_API_KEY
    ANTHROPIC_API_KEY
    DATABASE_PASSWORD
    MASTER_ENCRYPTION_KEY
  ].freeze

  def self.validate_keys!
    missing_keys = REQUIRED_KEYS.select { |key| ENV[key].nil? || ENV[key].empty? }

    if missing_keys.any?
      raise SecurityError, &quot;Missing required API keys: #{missing_keys.join(', ')}&quot;
    end

    # Validate key formats
    validate_openai_key(ENV['OPENAI_API_KEY'])
    validate_anthropic_key(ENV['ANTHROPIC_API_KEY'])
  end

  def self.rotate_keys!
    # Implement key rotation logic
    puts &quot;Key rotation initiated at #{Time.current}&quot;

    # 1. Generate new keys
    # 2. Update configuration
    # 3. Test connectivity
    # 4. Revoke old keys
    # 5. Log rotation event
  end

  private

  def self.validate_openai_key(key)
    unless key&amp;.start_with?('sk-') &amp;&amp; key.length &gt;= 50
      raise SecurityError, 'Invalid OpenAI API key format'
    end
  end

  def self.validate_anthropic_key(key)
    unless key&amp;.start_with?('sk-ant-') &amp;&amp; key.length &gt;= 100
      raise SecurityError, 'Invalid Anthropic API key format'
    end
  end
end

# Initialize security checks
APIKeyManager.validate_keys!
</code></pre>
<h4 id="token-based-authentication">Token-Based Authentication</h4>
<pre><code class="language-ruby"># JWT token authentication for API access
class TokenAuthenticator
  def initialize(secret_key = ENV['JWT_SECRET_KEY'])
    @secret_key = secret_key || raise('JWT_SECRET_KEY required')
  end

  def generate_token(user_id, permissions = [])
    payload = {
      user_id: user_id,
      permissions: permissions,
      iat: Time.current.to_i,
      exp: (Time.current + 1.hour).to_i  # 1 hour expiry
    }

    JWT.encode(payload, @secret_key, 'HS256')
  end

  def verify_token(token)
    decoded = JWT.decode(token, @secret_key, true, algorithm: 'HS256')
    payload = decoded.first

    # Check expiration
    if Time.current.to_i &gt; payload['exp']
      raise SecurityError, 'Token expired'
    end

    payload
  rescue JWT::DecodeError =&gt; e
    raise SecurityError, &quot;Invalid token: #{e.message}&quot;
  end
end
</code></pre>
<h3 id="authorization">Authorization</h3>
<h4 id="role-based-access-control">Role-Based Access Control</h4>
<pre><code class="language-ruby"># RBAC implementation
class AccessController
  PERMISSIONS = {
    'admin' =&gt; %w[read write delete manage],
    'editor' =&gt; %w[read write],
    'viewer' =&gt; %w[read],
    'api_user' =&gt; %w[read search]
  }.freeze

  def self.check_permission(user_role, action, resource = nil)
    user_permissions = PERMISSIONS[user_role] || []

    unless user_permissions.include?(action)
      raise SecurityError, &quot;Access denied: #{user_role} cannot #{action}&quot;
    end

    # Additional resource-level checks
    if resource &amp;&amp; !resource_accessible?(user_role, resource)
      raise SecurityError, &quot;Resource access denied&quot;
    end

    true
  end

  private

  def self.resource_accessible?(user_role, resource)
    # Implement resource-specific access logic
    case resource
    when Ragdoll::Core::Models::Document
      # Check document ownership or sharing permissions
      true  # Placeholder
    else
      true
    end
  end
end
</code></pre>
<h2 id="file-upload-security">File Upload Security</h2>
<h3 id="file-validation">File Validation</h3>
<pre><code class="language-ruby"># Comprehensive file validation
class FileValidator
  ALLOWED_MIME_TYPES = %w[
    application/pdf
    text/plain
    text/markdown
    text/html
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
    image/jpeg
    image/png
    image/gif
  ].freeze

  MAX_FILE_SIZE = 50.megabytes

  def self.validate_file(file_path)
    # Check file existence and readability
    unless File.exist?(file_path) &amp;&amp; File.readable?(file_path)
      raise SecurityError, &quot;File not accessible: #{file_path}&quot;
    end

    # Check file size
    file_size = File.size(file_path)
    if file_size &gt; MAX_FILE_SIZE
      raise SecurityError, &quot;File too large: #{file_size} bytes (max: #{MAX_FILE_SIZE})&quot;
    end

    # Validate MIME type
    mime_type = detect_mime_type(file_path)
    unless ALLOWED_MIME_TYPES.include?(mime_type)
      raise SecurityError, &quot;Unsupported file type: #{mime_type}&quot;
    end

    # Content-based validation
    validate_file_content(file_path, mime_type)

    true
  end

  private

  def self.detect_mime_type(file_path)
    # Use multiple methods for MIME type detection
    require 'mimemagic'

    # File extension check
    ext_mime = MIME::Types.type_for(file_path).first&amp;.content_type

    # Magic number check
    magic_mime = MimeMagic.by_path(file_path)&amp;.type

    # Verify consistency
    if ext_mime &amp;&amp; magic_mime &amp;&amp; ext_mime != magic_mime
      raise SecurityError, &quot;MIME type mismatch: extension=#{ext_mime}, magic=#{magic_mime}&quot;
    end

    magic_mime || ext_mime || 'application/octet-stream'
  end

  def self.validate_file_content(file_path, mime_type)
    case mime_type
    when 'application/pdf'
      validate_pdf_content(file_path)
    when /^image\//
      validate_image_content(file_path)
    end
  end

  def self.validate_pdf_content(file_path)
    # Basic PDF structure validation
    File.open(file_path, 'rb') do |file|
      header = file.read(8)
      unless header.start_with?('%PDF-')
        raise SecurityError, &quot;Invalid PDF header&quot;
      end
    end
  end

  def self.validate_image_content(file_path)
    # Validate image using ImageMagick
    require 'rmagick'

    begin
      img = Magick::Image.read(file_path).first

      # Check for reasonable dimensions
      if img.columns &gt; 10_000 || img.rows &gt; 10_000
        raise SecurityError, &quot;Image dimensions too large: #{img.columns}x#{img.rows}&quot;
      end
    rescue Magick::ImageMagickError =&gt; e
      raise SecurityError, &quot;Invalid image file: #{e.message}&quot;
    end
  end
end
</code></pre>
<h3 id="secure-file-storage">Secure File Storage</h3>
<pre><code class="language-ruby"># Secure file storage implementation
class SecureFileStorage
  def initialize
    @storage_path = ENV['SECURE_STORAGE_PATH'] || '/secure/storage'
    @file_permissions = 0o600  # Owner read/write only
    @dir_permissions = 0o700   # Owner access only
  end

  def store_file(source_path, secure_filename)
    # Sanitize filename
    safe_filename = sanitize_filename(secure_filename)

    # Create secure directory structure
    date_path = Date.current.strftime('%Y/%m/%d')
    secure_dir = File.join(@storage_path, date_path)
    FileUtils.mkdir_p(secure_dir, mode: @dir_permissions)

    # Generate unique secure path
    secure_path = File.join(secure_dir, &quot;#{SecureRandom.uuid}_#{safe_filename}&quot;)

    # Copy file with secure permissions
    FileUtils.cp(source_path, secure_path)
    FileUtils.chmod(@file_permissions, secure_path)

    # Log file storage event
    SecurityLogger.log_file_storage(source_path, secure_path)

    secure_path
  end

  private

  def sanitize_filename(filename)
    # Remove dangerous characters
    sanitized = filename.gsub(/[^\w\-_\.]/, '_')

    # Prevent path traversal
    sanitized = File.basename(sanitized)

    # Limit length
    sanitized = sanitized[0..100] if sanitized.length &gt; 100

    sanitized
  end
end
</code></pre>
<h2 id="api-security">API Security</h2>
<h3 id="input-validation">Input Validation</h3>
<pre><code class="language-ruby"># Comprehensive input validation
class InputValidator
  # SQL injection prevention
  def self.validate_search_query(query)
    # Remove potential SQL injection patterns
    dangerous_patterns = [
      /';\s*(drop|delete|update|insert|create|alter)/i,
      /union\s+select/i,
      /exec\s*\(/i,
      /&lt;script[^&gt;]*&gt;/i
    ]

    dangerous_patterns.each do |pattern|
      if query.match?(pattern)
        raise SecurityError, &quot;Potentially dangerous query pattern detected&quot;
      end
    end

    # Limit query length
    if query.length &gt; 1000
      raise SecurityError, &quot;Query too long (max 1000 characters)&quot;
    end

    query.strip
  end

  # Parameter sanitization
  def self.sanitize_parameters(params)
    sanitized = {}

    params.each do |key, value|
      sanitized_key = sanitize_key(key)

      case value
      when String
        sanitized[sanitized_key] = sanitize_string(value)
      when Integer
        sanitized[sanitized_key] = value.clamp(0, 1_000_000)
      when Array
        sanitized[sanitized_key] = value.map { |v| sanitize_string(v.to_s) }
      when Hash
        sanitized[sanitized_key] = sanitize_parameters(value)
      else
        sanitized[sanitized_key] = value.to_s
      end
    end

    sanitized
  end

  private

  def self.sanitize_key(key)
    # Only allow alphanumeric keys with underscores
    key.to_s.gsub(/[^a-zA-Z0-9_]/, '')
  end

  def self.sanitize_string(str)
    # Remove control characters and limit length
    str.gsub(/[\x00-\x1f\x7f]/, '').strip[0..10_000]
  end
end
</code></pre>
<h3 id="rate-limiting">Rate Limiting</h3>
<pre><code class="language-ruby"># Rate limiting implementation
class RateLimiter
  def initialize(redis_client = Redis.new)
    @redis = redis_client
  end

  def check_rate_limit(identifier, limit: 100, window: 3600)
    key = &quot;rate_limit:#{identifier}&quot;
    current_time = Time.current.to_i
    window_start = current_time - window

    # Clean old entries
    @redis.zremrangebyscore(key, '-inf', window_start)

    # Count current requests
    current_count = @redis.zcard(key)

    if current_count &gt;= limit
      remaining_time = @redis.zrange(key, 0, 0, with_scores: true).first&amp;.last&amp;.to_i
      reset_time = remaining_time + window if remaining_time

      raise SecurityError, &quot;Rate limit exceeded. Reset at #{Time.at(reset_time)}&quot;
    end

    # Add current request
    @redis.zadd(key, current_time, SecureRandom.uuid)
    @redis.expire(key, window)

    {
      remaining: limit - current_count - 1,
      reset_time: current_time + window
    }
  end
end
</code></pre>
<h2 id="database-security">Database Security</h2>
<h3 id="connection-security">Connection Security</h3>
<pre><code class="language-ruby"># Secure database configuration
class DatabaseSecurity
  def self.configure_secure_connection
    Ragdoll::Core.configure do |config|
      config.database_config = {
        adapter: 'postgresql',
        database: ENV['DB_NAME'],
        username: ENV['DB_USER'],
        password: ENV['DB_PASSWORD'],
        host: ENV['DB_HOST'],
        port: ENV['DB_PORT']&amp;.to_i || 5432,

        # SSL configuration
        sslmode: 'require',
        sslcert: ENV['DB_SSL_CERT_PATH'],
        sslkey: ENV['DB_SSL_KEY_PATH'],
        sslrootcert: ENV['DB_SSL_CA_PATH'],

        # Connection pool security
        pool: 20,
        timeout: 5000,
        checkout_timeout: 5,
        idle_timeout: 300,

        # Query logging (be careful with sensitive data)
        logger: ENV['RAILS_ENV'] == 'production' ? nil : Logger.new(STDOUT)
      }
    end
  end

  def self.create_restricted_user
    # SQL commands to create restricted database user
    &lt;&lt;~SQL
      -- Create restricted user for application
      CREATE USER ragdoll_app WITH PASSWORD '#{ENV['DB_APP_PASSWORD']}';

      -- Grant only necessary permissions
      GRANT CONNECT ON DATABASE ragdoll_production TO ragdoll_app;
      GRANT USAGE ON SCHEMA public TO ragdoll_app;
      GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO ragdoll_app;
      GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO ragdoll_app;

      -- Revoke dangerous permissions
      REVOKE CREATE ON SCHEMA public FROM ragdoll_app;
      REVOKE ALL ON pg_user FROM ragdoll_app;
      REVOKE ALL ON pg_database FROM ragdoll_app;
    SQL
  end
end
</code></pre>
<h3 id="data-protection_1">Data Protection</h3>
<pre><code class="language-ruby"># PII data handling
class PIIProtection
  SENSITIVE_FIELDS = %w[email phone ssn credit_card].freeze

  def self.anonymize_content(content)
    anonymized = content.dup

    # Email anonymization
    anonymized.gsub!(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/, '[EMAIL]')

    # Phone number anonymization
    anonymized.gsub!(/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/, '[PHONE]')

    # SSN anonymization
    anonymized.gsub!(/\b\d{3}-\d{2}-\d{4}\b/, '[SSN]')

    # Credit card anonymization
    anonymized.gsub!(/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/, '[CREDIT_CARD]')

    anonymized
  end

  def self.contains_pii?(content)
    patterns = [
      /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/,  # Email
      /\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/,                          # Phone
      /\b\d{3}-\d{2}-\d{4}\b/,                                  # SSN
      /\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/             # Credit card
    ]

    patterns.any? { |pattern| content.match?(pattern) }
  end
end
</code></pre>
<h2 id="llm-provider-security">LLM Provider Security</h2>
<h3 id="api-key-protection">API Key Protection</h3>
<pre><code class="language-ruby"># Secure LLM API integration
class LLMSecurity
  def self.validate_api_responses(response)
    # Check for potential data leakage in responses
    if response.is_a?(Hash) &amp;&amp; response['error']
      error_msg = response['error']['message']

      # Remove potentially sensitive information from error messages
      sanitized_error = error_msg.gsub(/api[_-]?key[^\s]*/i, '[API_KEY]')
      sanitized_error = sanitized_error.gsub(/token[^\s]*/i, '[TOKEN]')

      response['error']['message'] = sanitized_error
    end

    response
  end

  def self.audit_llm_request(provider, model, request_data)
    # Log LLM requests for audit purposes (without sensitive data)
    audit_data = {
      timestamp: Time.current.iso8601,
      provider: provider,
      model: model,
      request_size: request_data.to_s.length,
      request_hash: Digest::SHA256.hexdigest(request_data.to_s),
      user_id: Current.user&amp;.id,
      ip_address: Current.ip_address
    }

    SecurityLogger.log_llm_request(audit_data)
  end
end
</code></pre>
<h3 id="data-privacy">Data Privacy</h3>
<pre><code class="language-ruby"># Content privacy protection
class ContentPrivacy
  def self.sanitize_for_llm(content)
    # Remove sensitive information before sending to LLM
    sanitized = PIIProtection.anonymize_content(content)

    # Remove internal references
    sanitized.gsub!(/\b(internal|confidential|proprietary)\b/i, '[REDACTED]')

    # Limit content size to prevent data leakage
    if sanitized.length &gt; 50_000
      sanitized = sanitized[0..50_000] + &quot;\n[CONTENT TRUNCATED FOR SECURITY]&quot;
    end

    sanitized
  end

  def self.should_process_with_llm?(content, metadata = {})
    # Check if content is safe to send to external LLM
    return false if PIIProtection.contains_pii?(content)
    return false if metadata[:confidentiality] == 'high'
    return false if content.match?(/confidential|secret|private/i)

    true
  end
end
</code></pre>
<h2 id="compliance">Compliance</h2>
<h3 id="gdpr-compliance">GDPR Compliance</h3>
<pre><code class="language-ruby"># GDPR compliance implementation
class GDPRCompliance
  def self.handle_data_subject_request(request_type, user_id)
    case request_type
    when 'access'
      export_user_data(user_id)
    when 'rectification'
      allow_data_correction(user_id)
    when 'erasure'
      delete_user_data(user_id)
    when 'portability'
      export_user_data_portable(user_id)
    end
  end

  private

  def self.delete_user_data(user_id)
    # Comprehensive data deletion
    Ragdoll::Core::Models::Document.where(user_id: user_id).destroy_all
    Ragdoll::Core::Models::Embedding.joins(:embeddable)
                                   .where(ragdoll_contents: { user_id: user_id })
                                   .destroy_all

    # Log deletion for audit
    SecurityLogger.log_data_deletion(user_id, Time.current)
  end
end
</code></pre>
<h3 id="security-auditing">Security Auditing</h3>
<pre><code class="language-ruby"># Comprehensive security logging
class SecurityLogger
  def self.log_security_event(event_type, details = {})
    log_entry = {
      timestamp: Time.current.iso8601,
      event_type: event_type,
      user_id: Current.user&amp;.id,
      ip_address: Current.ip_address,
      user_agent: Current.user_agent,
      session_id: Current.session_id,
      details: details
    }

    # Log to secure audit file
    audit_logger.info(log_entry.to_json)

    # Send to SIEM if configured
    send_to_siem(log_entry) if ENV['SIEM_ENDPOINT']
  end

  def self.log_file_storage(source, destination)
    log_security_event('file_stored', {
      source_path: source,
      destination_path: destination,
      file_size: File.size(destination)
    })
  end

  def self.log_data_deletion(user_id, timestamp)
    log_security_event('data_deleted', {
      target_user_id: user_id,
      deletion_timestamp: timestamp
    })
  end

  private

  def self.audit_logger
    @audit_logger ||= Logger.new(
      ENV['SECURITY_LOG_PATH'] || '/var/log/ragdoll/security.log',
      10,  # Keep 10 old log files
      100.megabytes  # Max 100MB per file
    )
  end
end
</code></pre>
<h2 id="security-monitoring">Security Monitoring</h2>
<h3 id="threat-detection">Threat Detection</h3>
<pre><code class="language-ruby"># Anomaly detection system
class ThreatDetector
  def self.detect_anomalies
    {
      unusual_access_patterns: detect_unusual_access,
      bulk_data_access: detect_bulk_access,
      failed_auth_attempts: detect_auth_failures,
      suspicious_queries: detect_suspicious_queries
    }
  end

  private

  def self.detect_unusual_access
    # Detect access patterns outside normal hours
    current_hour = Time.current.hour

    if (current_hour &lt; 6 || current_hour &gt; 22) &amp;&amp; 
       Rails.env.production? &amp;&amp; 
       recent_activity_count &gt; 100
      {
        type: 'off_hours_access',
        severity: 'medium',
        count: recent_activity_count
      }
    end
  end

  def self.detect_bulk_access
    # Detect potential data exfiltration
    recent_searches = SearchLog.where('created_at &gt; ?', 1.hour.ago)

    if recent_searches.count &gt; 1000
      {
        type: 'bulk_access',
        severity: 'high',
        count: recent_searches.count
      }
    end
  end
end
</code></pre>
<h3 id="incident-response">Incident Response</h3>
<pre><code class="language-ruby"># Security incident response system
class IncidentResponse
  def self.handle_security_incident(incident_type, severity, details)
    incident_id = SecureRandom.uuid

    # Log incident
    SecurityLogger.log_security_event('security_incident', {
      incident_id: incident_id,
      type: incident_type,
      severity: severity,
      details: details
    })

    # Immediate response based on severity
    case severity
    when 'critical'
      # Immediate lockdown
      initiate_lockdown_procedures
      notify_security_team
      escalate_to_management
    when 'high'
      # Enhanced monitoring
      increase_monitoring_level
      notify_security_team
    when 'medium'
      # Standard response
      log_for_review
    end

    incident_id
  end

  private

  def self.initiate_lockdown_procedures
    # Disable API access
    Rails.cache.write('api_lockdown', true, expires_in: 1.hour)

    # Revoke active sessions
    ActiveSession.where('created_at &gt; ?', 24.hours.ago).destroy_all

    # Alert administrators
    SecurityAlert.create!(
      type: 'lockdown_initiated',
      message: 'Security lockdown initiated due to critical incident'
    )
  end
end
</code></pre>
<h2 id="production-security-checklist">Production Security Checklist</h2>
<h3 id="pre-deployment-security-checklist">Pre-Deployment Security Checklist</h3>
<ul>
<li>[ ] <strong>Database Security</strong></li>
<li>[ ] PostgreSQL SSL/TLS enabled</li>
<li>[ ] Database user permissions restricted</li>
<li>[ ] Connection encryption configured</li>
<li>
<p>[ ] Backup encryption enabled</p>
</li>
<li>
<p>[ ] <strong>API Security</strong></p>
</li>
<li>[ ] All API keys rotated and secured</li>
<li>[ ] Rate limiting implemented</li>
<li>[ ] Input validation comprehensive</li>
<li>
<p>[ ] Error messages sanitized</p>
</li>
<li>
<p>[ ] <strong>File Security</strong></p>
</li>
<li>[ ] File upload validation implemented</li>
<li>[ ] File storage encryption configured</li>
<li>[ ] File access permissions restricted</li>
<li>
<p>[ ] Malware scanning enabled</p>
</li>
<li>
<p>[ ] <strong>Monitoring &amp; Logging</strong></p>
</li>
<li>[ ] Security event logging enabled</li>
<li>[ ] Audit trails comprehensive</li>
<li>[ ] Anomaly detection configured</li>
<li>
<p>[ ] Incident response procedures documented</p>
</li>
<li>
<p>[ ] <strong>Compliance</strong></p>
</li>
<li>[ ] GDPR compliance measures implemented</li>
<li>[ ] Data retention policies configured</li>
<li>[ ] Privacy controls operational</li>
<li>[ ] Audit procedures established</li>
</ul>
<h3 id="regular-security-maintenance">Regular Security Maintenance</h3>
<pre><code class="language-bash"># Monthly security maintenance script
#!/bin/bash

# Rotate API keys
echo &quot;Rotating API keys...&quot;
rake security:rotate_keys

# Update security certificates
echo &quot;Updating SSL certificates...&quot;
rake security:update_certificates

# Run security audit
echo &quot;Running security audit...&quot;
rake security:audit

# Generate security report
echo &quot;Generating security report...&quot;
rake security:report

# Check for security vulnerabilities
echo &quot;Checking for vulnerabilities...&quot;
bundle audit
</code></pre>
<hr />
<p><em>This document is part of the Ragdoll documentation suite. For immediate help, see the <a href="../quick-start/">Quick Start Guide</a> or <a href="../api-client/">API Reference</a>.</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>