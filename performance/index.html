
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../multi-modal/">
      
      
        <link rel="next" href="../quick-start/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Performance Tuning - Ragdoll Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#performance-tuning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ragdoll Documentation" class="md-header__button md-logo" aria-label="Ragdoll Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ragdoll Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Performance Tuning
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ragdoll Documentation" class="md-nav__button md-logo" aria-label="Ragdoll Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ragdoll Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ragdoll Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../background-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Background Processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../database-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Production Deployment Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../document-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../embedding-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment-variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment Variables Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extending the System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../file-uploads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Upload System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation &amp; Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Integration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata-schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata Schemas
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring &amp; Analytics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-modal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Modal Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Performance Tuning
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Performance Tuning
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optimization-strategies-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization Strategies and Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization Strategies and Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-performance-areas" class="md-nav__link">
    <span class="md-ellipsis">
      Key Performance Areas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Database Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgresql-pgvector-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      PostgreSQL + pgvector Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PostgreSQL + pgvector Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vector-index-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Index Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-pool-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Pool Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Query Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-allocation-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Allocation Tuning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector-search-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Search Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Search Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-strategy-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Index Strategy Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#similarity-threshold-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Similarity Threshold Tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-processing-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Processing Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedding-cache-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Embedding Cache Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-lifecycle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Object Lifecycle Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-leak-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Leak Prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background-job-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Background Job Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Background Job Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queue-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Worker Scaling Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-processing-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Processing Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Application Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-layer-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Service Layer Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-response-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      API Response Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Profiling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Profiling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics-to-track" class="md-nav__link">
    <span class="md-ellipsis">
      Key Metrics to Track
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Benchmarking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#horizontal-scaling-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Horizontal Scaling Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-sharding-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Database Sharding Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Load Testing Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-optimization-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Production Optimization Checklist
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search &amp; Analytics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optimization-strategies-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization Strategies and Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization Strategies and Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-performance-areas" class="md-nav__link">
    <span class="md-ellipsis">
      Key Performance Areas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Database Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgresql-pgvector-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      PostgreSQL + pgvector Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PostgreSQL + pgvector Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vector-index-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Index Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-pool-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Pool Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Query Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-allocation-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Allocation Tuning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector-search-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Search Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Search Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-strategy-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Index Strategy Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#similarity-threshold-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Similarity Threshold Tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-processing-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Processing Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedding-cache-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Embedding Cache Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-lifecycle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Object Lifecycle Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-leak-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Leak Prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background-job-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Background Job Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Background Job Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queue-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Queue Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Worker Scaling Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-processing-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Processing Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Application Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-layer-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Service Layer Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-response-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      API Response Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Profiling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Profiling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics-to-track" class="md-nav__link">
    <span class="md-ellipsis">
      Key Metrics to Track
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Benchmarking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#horizontal-scaling-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Horizontal Scaling Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-sharding-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Database Sharding Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Load Testing Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-optimization-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Production Optimization Checklist
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="performance-tuning">Performance Tuning</h1>
<h2 id="optimization-strategies-and-monitoring">Optimization Strategies and Monitoring</h2>
<p>Ragdoll is designed for high-performance RAG operations with PostgreSQL and pgvector at its foundation. This guide covers comprehensive optimization strategies for production deployments.</p>
<h3 id="key-performance-areas">Key Performance Areas</h3>
<ul>
<li><strong>Database optimization</strong>: PostgreSQL + pgvector tuning</li>
<li><strong>Vector search performance</strong>: Index strategies and similarity search optimization</li>
<li><strong>Memory management</strong>: Embedding caching and object lifecycle</li>
<li><strong>Background job performance</strong>: ActiveJob and queue optimization</li>
<li><strong>Application-level optimization</strong>: Service layer and API response tuning</li>
</ul>
<h2 id="database-performance">Database Performance</h2>
<h3 id="postgresql-pgvector-optimization">PostgreSQL + pgvector Optimization</h3>
<h4 id="vector-index-configuration">Vector Index Configuration</h4>
<pre><code class="language-sql">-- IVFFlat index for embeddings (default in Ragdoll)
CREATE INDEX CONCURRENTLY ragdoll_embeddings_vector_idx 
ON ragdoll_embeddings 
USING ivfflat (embedding_vector vector_cosine_ops) 
WITH (lists = 100);

-- HNSW index for better performance (PostgreSQL 14+)
CREATE INDEX CONCURRENTLY ragdoll_embeddings_hnsw_idx 
ON ragdoll_embeddings 
USING hnsw (embedding_vector vector_cosine_ops) 
WITH (m = 16, ef_construction = 64);
</code></pre>
<h4 id="connection-pool-configuration">Connection Pool Configuration</h4>
<pre><code class="language-ruby"># config/database.yml or Ragdoll configuration
Ragdoll::Core.configure do |config|
  config.database_config = {
    adapter: 'postgresql',
    database: 'ragdoll_production',
    username: 'ragdoll',
    password: ENV['DATABASE_PASSWORD'],
    host: 'localhost',
    port: 5432,
    pool: 20,              # Connection pool size
    timeout: 5000,         # Connection timeout in ms
    checkout_timeout: 5,   # Pool checkout timeout
    reaping_frequency: 10  # Dead connection reaping
  }
end
</code></pre>
<h4 id="query-optimization">Query Optimization</h4>
<pre><code class="language-ruby"># Optimize embedding searches with proper scoping
results = Models::Embedding
  .includes(:embeddable) # Eager load to avoid N+1
  .nearest_neighbors(:embedding_vector, query_vector, distance: &quot;cosine&quot;)
  .limit(50)
  .where(&quot;neighbor_distance &lt; ?&quot;, 0.3) # Threshold filtering
</code></pre>
<h4 id="memory-allocation-tuning">Memory Allocation Tuning</h4>
<pre><code class="language-sql">-- PostgreSQL configuration (postgresql.conf)
shared_buffers = 256MB          # 25% of RAM for small systems
effective_cache_size = 1GB      # Available memory for caching
work_mem = 4MB                  # Per-operation memory
maintenance_work_mem = 64MB     # Maintenance operations
max_connections = 100           # Concurrent connections

-- pgvector specific
hnsw.ef_search = 40             # HNSW search parameter
</code></pre>
<h2 id="vector-search-optimization">Vector Search Optimization</h2>
<h3 id="index-strategy-selection">Index Strategy Selection</h3>
<pre><code class="language-mermaid">flowchart TD
    A[Vector Search Requirements] --&gt; B{Dataset Size}
    B --&gt;|&lt; 100K vectors| C[IVFFlat Index]
    B --&gt;|&gt; 100K vectors| D[HNSW Index]

    C --&gt; E[Good recall/performance balance]
    D --&gt; F[Better performance, higher memory]

    E --&gt; G[lists = sqrt(rows)]
    F --&gt; H[m=16, ef_construction=64]

    G --&gt; I[Moderate build time]
    H --&gt; J[Longer build time]
</code></pre>
<h3 id="similarity-threshold-tuning">Similarity Threshold Tuning</h3>
<pre><code class="language-ruby"># Performance vs accuracy trade-offs
class SearchEngine
  PERFORMANCE_THRESHOLDS = {
    high_precision: 0.85,   # Fewer, more relevant results
    balanced: 0.70,         # Default Ragdoll setting
    high_recall: 0.50       # More results, lower precision
  }

  def search_optimized(query, mode: :balanced)
    threshold = PERFORMANCE_THRESHOLDS[mode]
    search_similar_content(query, threshold: threshold)
  end
end
</code></pre>
<h3 id="batch-processing-optimization">Batch Processing Optimization</h3>
<pre><code class="language-ruby"># Efficient batch embedding generation
class EmbeddingService
  def generate_embeddings_batch_optimized(texts, batch_size: 50)
    texts.each_slice(batch_size).flat_map do |batch|
      generate_embeddings_batch(batch)
    end
  end
end
</code></pre>
<h2 id="memory-management">Memory Management</h2>
<h3 id="embedding-cache-strategies">Embedding Cache Strategies</h3>
<pre><code class="language-ruby"># In-memory embedding cache
class EmbeddingCache
  def initialize(max_size: 1000)
    @cache = {}
    @max_size = max_size
    @access_times = {}
  end

  def get_or_generate(text)
    key = Digest::SHA256.hexdigest(text)

    if @cache.key?(key)
      @access_times[key] = Time.current
      return @cache[key]
    end

    embedding = generate_embedding(text)
    store_with_eviction(key, embedding)
    embedding
  end

  private

  def store_with_eviction(key, embedding)
    if @cache.size &gt;= @max_size
      # Evict least recently used
      lru_key = @access_times.min_by { |_, time| time }&amp;.first
      @cache.delete(lru_key)
      @access_times.delete(lru_key)
    end

    @cache[key] = embedding
    @access_times[key] = Time.current
  end
end
</code></pre>
<h3 id="object-lifecycle-management">Object Lifecycle Management</h3>
<pre><code class="language-ruby"># Efficient document processing
class DocumentProcessor
  def self.process_large_document(file_path)
    File.open(file_path, 'r') do |file|
      file.each_line.lazy
          .each_slice(1000)  # Process in chunks
          .each do |chunk|
            process_chunk(chunk.join)
            GC.start if chunk.size % 10 == 0  # Periodic GC
          end
    end
  end
end
</code></pre>
<h3 id="memory-leak-prevention">Memory Leak Prevention</h3>
<pre><code class="language-ruby"># Monitor memory usage in background jobs
class GenerateEmbeddings &lt; ActiveJob::Base
  def perform(document_id)
    memory_before = get_memory_usage

    # Process document
    process_document(document_id)

    memory_after = get_memory_usage

    if (memory_after - memory_before) &gt; 100.megabytes
      Rails.logger.warn &quot;High memory usage detected: #{memory_after - memory_before} MB&quot;
    end
  end

  private

  def get_memory_usage
    `ps -o rss= -p #{Process.pid}`.to_i.kilobytes
  end
end
</code></pre>
<h2 id="background-job-performance">Background Job Performance</h2>
<h3 id="queue-configuration">Queue Configuration</h3>
<pre><code class="language-ruby"># Sidekiq configuration for production
Ragdoll::Core.configure do |config|
  # Use Sidekiq for background processing
  ActiveJob::Base.queue_adapter = :sidekiq
end

# config/sidekiq.yml
:concurrency: 10
:queues:
  - [critical, 4]
  - [embeddings, 3]
  - [default, 2]
  - [low, 1]
</code></pre>
<h3 id="worker-scaling-strategies">Worker Scaling Strategies</h3>
<pre><code class="language-ruby"># Dynamic worker scaling based on queue size
class WorkerScaler
  def self.scale_workers
    queue_size = Sidekiq::Queue.new('embeddings').size

    case queue_size
    when 0..10
      target_workers = 2
    when 11..50
      target_workers = 5
    when 51..100
      target_workers = 10
    else
      target_workers = 15
    end

    adjust_worker_count(target_workers)
  end
end
</code></pre>
<h3 id="batch-processing-techniques">Batch Processing Techniques</h3>
<pre><code class="language-ruby"># Efficient batch job processing
class BatchEmbeddingJob &lt; ActiveJob::Base
  def perform(document_ids)
    document_ids.each_slice(10) do |batch|
      process_batch(batch)

      # Yield control to other jobs
      sleep(0.1) if batch.size == 10
    end
  end

  private

  def process_batch(document_ids)
    documents = Document.where(id: document_ids).includes(:contents)

    # Batch generate embeddings
    contents = documents.flat_map(&amp;:contents)
    texts = contents.map(&amp;:content)
    embeddings = EmbeddingService.new.generate_embeddings_batch(texts)

    # Bulk insert embeddings
    embedding_data = contents.zip(embeddings).map do |content, embedding|
      {
        embeddable: content,
        embedding_vector: embedding,
        content: content.content,
        chunk_index: 0,
        created_at: Time.current,
        updated_at: Time.current
      }
    end

    Models::Embedding.insert_all(embedding_data)
  end
end
</code></pre>
<h2 id="application-performance">Application Performance</h2>
<h3 id="service-layer-optimization">Service Layer Optimization</h3>
<pre><code class="language-ruby"># Optimized search engine with caching
class SearchEngine
  def initialize(embedding_service)
    @embedding_service = embedding_service
    @query_cache = LRUCache.new(100)
  end

  def search_similar_content(query, **options)
    cache_key = &quot;#{query}_#{options.hash}&quot;

    @query_cache.fetch(cache_key) do
      perform_search(query, **options)
    end
  end

  private

  def perform_search(query, **options)
    # Cached embedding generation
    query_embedding = @embedding_service.generate_embedding_cached(query)

    # Optimized database query
    Models::Embedding.search_similar(
      query_embedding,
      limit: options[:limit] || 20,
      threshold: options[:threshold] || 0.7
    )
  end
end
</code></pre>
<h3 id="api-response-optimization">API Response Optimization</h3>
<pre><code class="language-ruby"># Streaming responses for large result sets
class Client
  def search_stream(query:, **options)
    Enumerator.new do |yielder|
      results = search_similar_content(query: query, **options)

      results.find_each(batch_size: 100) do |result|
        yielder &lt;&lt; format_result(result)
      end
    end
  end
end
</code></pre>
<h2 id="monitoring-and-profiling">Monitoring and Profiling</h2>
<h3 id="key-metrics-to-track">Key Metrics to Track</h3>
<pre><code class="language-ruby"># Custom metrics collection
class PerformanceMonitor
  METRICS = {
    embedding_generation_time: 'histogram',
    search_query_time: 'histogram',
    database_connection_pool: 'gauge',
    memory_usage: 'gauge',
    background_job_queue_size: 'gauge'
  }

  def self.track_embedding_generation(text_length)
    start_time = Time.current
    yield
    duration = Time.current - start_time

    # Log metrics (integrate with your monitoring system)
    Rails.logger.info({
      metric: 'embedding_generation',
      duration_ms: (duration * 1000).round(2),
      text_length: text_length,
      timestamp: Time.current.iso8601
    }.to_json)
  end
end
</code></pre>
<h3 id="performance-benchmarking">Performance Benchmarking</h3>
<pre><code class="language-ruby"># Benchmark suite for performance regression testing
class PerformanceBenchmark
  def self.run_search_benchmark
    queries = [
      &quot;machine learning algorithms&quot;,
      &quot;natural language processing&quot;,
      &quot;computer vision techniques&quot;
    ]

    client = Ragdoll::Core.client

    queries.each do |query|
      iterations = 100
      total_time = 0

      iterations.times do
        start_time = Time.current
        client.search(query: query)
        total_time += Time.current - start_time
      end

      avg_time = (total_time / iterations * 1000).round(2)
      puts &quot;Query: #{query} - Average time: #{avg_time}ms&quot;
    end
  end
end
</code></pre>
<h2 id="scaling-strategies">Scaling Strategies</h2>
<h3 id="horizontal-scaling-architecture">Horizontal Scaling Architecture</h3>
<pre><code class="language-mermaid">flowchart TB
    A[Load Balancer] --&gt; B[App Server 1]
    A --&gt; C[App Server 2]
    A --&gt; D[App Server N]

    B --&gt; E[PostgreSQL Primary]
    C --&gt; E
    D --&gt; E

    E --&gt; F[PostgreSQL Read Replica 1]
    E --&gt; G[PostgreSQL Read Replica 2]

    B --&gt; H[Redis Sidekiq]
    C --&gt; H
    D --&gt; H

    H --&gt; I[Sidekiq Worker Pool]
</code></pre>
<h3 id="database-sharding-considerations">Database Sharding Considerations</h3>
<pre><code class="language-ruby"># Document-based sharding strategy
class ShardedDocument &lt; Document
  def self.shard_key(document_id)
    Digest::SHA1.hexdigest(document_id.to_s)[0..7].to_i(16) % 4
  end

  def self.find_sharded(document_id)
    shard = shard_key(document_id)
    connection_handler.retrieve_connection(&quot;shard_#{shard}&quot;)
    find(document_id)
  end
end
</code></pre>
<h3 id="load-testing-strategy">Load Testing Strategy</h3>
<pre><code class="language-ruby"># Load testing with realistic usage patterns
class LoadTest
  def self.simulate_concurrent_searches(concurrent_users: 50)
    threads = []

    concurrent_users.times do |i|
      threads &lt;&lt; Thread.new do
        client = Ragdoll::Core.client

        10.times do
          query = generate_random_query
          start_time = Time.current

          begin
            client.search(query: query)
            duration = Time.current - start_time

            puts &quot;Thread #{i}: #{query} - #{(duration * 1000).round(2)}ms&quot;
          rescue =&gt; e
            puts &quot;Thread #{i}: Error - #{e.message}&quot;
          end

          sleep(rand(0.5..2.0)) # Realistic user behavior
        end
      end
    end

    threads.each(&amp;:join)
  end
end
</code></pre>
<h2 id="production-optimization-checklist">Production Optimization Checklist</h2>
<ul>
<li>[ ] Configure PostgreSQL connection pooling (20+ connections)</li>
<li>[ ] Set up pgvector indexes (IVFFlat or HNSW)</li>
<li>[ ] Implement embedding caching strategy</li>
<li>[ ] Configure background job queues with priorities</li>
<li>[ ] Set up performance monitoring and alerting</li>
<li>[ ] Implement database read replicas for search queries</li>
<li>[ ] Configure memory limits and garbage collection</li>
<li>[ ] Set up load testing and performance benchmarks</li>
<li>[ ] Implement query result caching</li>
<li>[ ] Configure log aggregation and analysis</li>
</ul>
<hr />
<p><em>This document is part of the Ragdoll documentation suite. For immediate help, see the <a href="../quick-start/">Quick Start Guide</a> or <a href="../api-client/">API Reference</a>.</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>