
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../llm-integration/">
      
      
        <link rel="next" href="../monitoring/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Metadata Schemas - Ragdoll Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#metadata-schemas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ragdoll Documentation" class="md-header__button md-logo" aria-label="Ragdoll Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ragdoll Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metadata Schemas
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ragdoll Documentation" class="md-nav__button md-logo" aria-label="Ragdoll Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ragdoll Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ragdoll Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../background-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Background Processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../database-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Production Deployment Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../document-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../embedding-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment-variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment Variables Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extending the System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../file-uploads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Upload System
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation &amp; Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Integration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Metadata Schemas
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Metadata Schemas
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#structured-content-analysis-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Structured Content Analysis and Validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dual-metadata-system" class="md-nav__link">
    <span class="md-ellipsis">
      Dual Metadata System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-type-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Content Type Schemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-metadata-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Standard Metadata Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Standard Metadata Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-analysis-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Content Analysis Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Content Analysis Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keyword-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Keyword Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topic-classification" class="md-nav__link">
    <span class="md-ellipsis">
      Topic Classification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentiment-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Sentiment Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-categorization" class="md-nav__link">
    <span class="md-ellipsis">
      Content Categorization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Metadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#processing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-data" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validation Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-fields-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Required Fields Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-type-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Data Type Constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Format Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Range Constraints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-error-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Error Reporting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-compatibility-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Compatibility Checking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Fallback Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Thresholds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Schemas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Schemas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-definition" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Definition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Definition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema-format" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-type-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Field Type Definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-rule-specification" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Rule Specification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation Requirements
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-loading-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Loading Mechanisms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-management" class="md-nav__link">
    <span class="md-ellipsis">
      Version Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Migration Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-specific-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Domain-Specific Schemas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domain-Specific Schemas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#academic-papers" class="md-nav__link">
    <span class="md-ellipsis">
      Academic Papers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Academic Papers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citation-extraction-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Citation Extraction Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#legal-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Legal Documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Legal Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legal-classification-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Legal Classification Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-documentation-schema" class="md-nav__link">
    <span class="md-ellipsis">
      API Documentation Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-documentation-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Code Documentation Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm-metadata-generation" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Metadata Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Metadata Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Generation Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generation Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-analysis-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Content Analysis Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-selection-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Model Selection Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt Engineering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prompt Engineering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-aware-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Schema-Aware Prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistency-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Consistency Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-reduction-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Error Reduction Techniques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-language-support" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Language Support
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring &amp; Analytics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-modal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Modal Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance Tuning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search &amp; Analytics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#structured-content-analysis-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Structured Content Analysis and Validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dual-metadata-system" class="md-nav__link">
    <span class="md-ellipsis">
      Dual Metadata System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-type-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Content Type Schemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-metadata-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Standard Metadata Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Standard Metadata Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-analysis-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Content Analysis Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Content Analysis Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keyword-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Keyword Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topic-classification" class="md-nav__link">
    <span class="md-ellipsis">
      Topic Classification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentiment-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Sentiment Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-categorization" class="md-nav__link">
    <span class="md-ellipsis">
      Content Categorization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Metadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#processing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-data" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validation Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-fields-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Required Fields Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-type-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Data Type Constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Format Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Range Constraints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-error-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Error Reporting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-compatibility-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Compatibility Checking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Fallback Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-thresholds" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Thresholds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Schemas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Schemas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-definition" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Definition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Definition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema-format" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Schema Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-type-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Field Type Definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-rule-specification" class="md-nav__link">
    <span class="md-ellipsis">
      Validation Rule Specification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation Requirements
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-loading-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Loading Mechanisms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-management" class="md-nav__link">
    <span class="md-ellipsis">
      Version Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Migration Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-specific-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Domain-Specific Schemas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Domain-Specific Schemas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#academic-papers" class="md-nav__link">
    <span class="md-ellipsis">
      Academic Papers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Academic Papers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citation-extraction-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Citation Extraction Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#legal-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Legal Documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Legal Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legal-classification-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Legal Classification Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-documentation-schema" class="md-nav__link">
    <span class="md-ellipsis">
      API Documentation Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-documentation-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Code Documentation Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm-metadata-generation" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Metadata Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Metadata Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Generation Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generation Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-analysis-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Content Analysis Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-selection-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Model Selection Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt Engineering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prompt Engineering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-aware-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Schema-Aware Prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistency-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Consistency Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-reduction-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Error Reduction Techniques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-language-support" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Language Support
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="metadata-schemas">Metadata Schemas</h1>
<p>Ragdoll implements a sophisticated metadata schema system that ensures consistent, structured metadata generation across different content types. The system uses JSON Schema-based definitions to guide LLM-powered metadata extraction and validate the resulting structured data.</p>
<h2 id="structured-content-analysis-and-validation">Structured Content Analysis and Validation</h2>
<p>The metadata schema system provides:</p>
<ul>
<li><strong>Content-Type Specific Schemas</strong>: Tailored metadata structures for text, images, audio, PDFs, and multi-modal content</li>
<li><strong>LLM-Guided Generation</strong>: Schema-aware prompts ensure consistent metadata format and quality</li>
<li><strong>Validation Framework</strong>: Automatic validation of generated metadata against defined schemas</li>
<li><strong>Extensible Architecture</strong>: Easy addition of new content types and custom schema definitions</li>
<li><strong>Dual Metadata System</strong>: Separation of LLM-generated content metadata and system file metadata</li>
<li><strong>Quality Assurance</strong>: Built-in fallback strategies and error handling for robust metadata generation</li>
</ul>
<h2 id="schema-architecture">Schema Architecture</h2>
<p>Ragdoll uses a dual metadata architecture that separates concerns between AI-generated content insights and technical file properties:</p>
<h3 id="dual-metadata-system">Dual Metadata System</h3>
<p><strong>LLM-Generated Content Metadata (<code>metadata</code> column)</strong></p>
<pre><code class="language-ruby"># Stored in document.metadata (JSON column)
{
  &quot;summary&quot;: &quot;This research paper explores machine learning applications...&quot;,
  &quot;keywords&quot;: [&quot;machine learning&quot;, &quot;neural networks&quot;, &quot;AI&quot;],
  &quot;classification&quot;: &quot;research&quot;,
  &quot;topics&quot;: [&quot;artificial intelligence&quot;, &quot;computer science&quot;],
  &quot;sentiment&quot;: &quot;neutral&quot;,
  &quot;complexity_level&quot;: &quot;advanced&quot;,
  &quot;reading_time_minutes&quot;: 25,
  &quot;language&quot;: &quot;en&quot;,
  &quot;tags&quot;: [&quot;AI&quot;, &quot;research&quot;, &quot;academic&quot;]
}
</code></pre>
<p><strong>System-Generated File Metadata (<code>file_metadata</code> column)</strong></p>
<pre><code class="language-ruby"># Stored in document.file_metadata (JSON column)
{
  &quot;file_size&quot;: 2048576,
  &quot;file_type&quot;: &quot;pdf&quot;,
  &quot;page_count&quot;: 15,
  &quot;creation_date&quot;: &quot;2024-01-15T10:30:00Z&quot;,
  &quot;modification_date&quot;: &quot;2024-01-20T14:15:30Z&quot;,
  &quot;author&quot;: &quot;Dr. Jane Smith&quot;,
  &quot;title&quot;: &quot;Advanced ML Techniques&quot;,
  &quot;encoding&quot;: &quot;UTF-8&quot;,
  &quot;extraction_method&quot;: &quot;pdf-reader&quot;,
  &quot;processing_time_ms&quot;: 1250
}
</code></pre>
<p><strong>Schema Separation Rationale:</strong>
1. <strong>Semantic vs Technical</strong>: Content metadata focuses on meaning, file metadata on technical properties
2. <strong>LLM vs System Generated</strong>: Different generation methods require different validation approaches
3. <strong>Update Patterns</strong>: Content metadata may be regenerated, file metadata is typically static
4. <strong>Search Optimization</strong>: Separate indexes for semantic search vs file property filtering
5. <strong>Schema Evolution</strong>: Content schemas evolve with AI capabilities, file schemas remain stable</p>
<p><strong>Integration Patterns:</strong></p>
<pre><code class="language-ruby"># Combined search across both metadata types
Document.search_combined(
  content_query: &quot;machine learning&quot;,  # Searches content metadata
  file_filters: { file_type: 'pdf', page_count: 10..50 }  # Filters file metadata
)

# Unified metadata access
document.combined_metadata  # Merges both metadata types
document.searchable_content # Optimized for search indexing
</code></pre>
<h3 id="content-type-schemas">Content Type Schemas</h3>
<p>Ragdoll provides specialized schemas for different content types:</p>
<pre><code class="language-mermaid">graph TD
    A[Base Schema] --&gt; B[Text Schema]
    A --&gt; C[Image Schema]
    A --&gt; D[Audio Schema]
    A --&gt; E[PDF Schema]
    A --&gt; F[Mixed Schema]

    B --&gt; B1[&quot;summary, keywords, classification&quot;]
    C --&gt; C1[&quot;description, objects, scene_type&quot;]
    D --&gt; D1[&quot;transcript_summary, speakers, content_type&quot;]
    E --&gt; E1[&quot;document_type, structure, reading_time&quot;]
    F --&gt; F1[&quot;content_types, cohesion_analysis&quot;]
</code></pre>
<p><strong>Schema Inheritance Pattern:</strong></p>
<pre><code class="language-ruby">module MetadataSchemas
  # Base fields common to all content types
  BASE_PROPERTIES = {
    summary: { type: &quot;string&quot;, description: &quot;Content summary&quot; },
    keywords: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
    classification: { type: &quot;string&quot; },
    tags: { type: &quot;array&quot;, items: { type: &quot;string&quot; } }
  }.freeze

  # Content-specific extensions
  TEXT_EXTENSIONS = {
    reading_time_minutes: { type: &quot;integer&quot; },
    complexity_level: { type: &quot;string&quot;, enum: %w[beginner intermediate advanced expert] },
    sentiment: { type: &quot;string&quot;, enum: %w[positive negative neutral mixed] }
  }.freeze

  # Combined schema
  TEXT_SCHEMA = {
    type: &quot;object&quot;,
    properties: BASE_PROPERTIES.merge(TEXT_EXTENSIONS),
    required: %w[summary keywords classification]
  }.freeze
end
</code></pre>
<h2 id="standard-metadata-fields">Standard Metadata Fields</h2>
<p>Ragdoll defines comprehensive metadata fields organized by function and content type:</p>
<h3 id="content-analysis-fields">Content Analysis Fields</h3>
<h4 id="summary-generation">Summary Generation</h4>
<pre><code class="language-ruby"># Text content summary
summary: {
  type: &quot;string&quot;,
  description: &quot;Concise summary of the text content (2-3 sentences)&quot;,
  min_length: 50,
  max_length: 500,
  required: true
}

# Image content summary
summary: {
  type: &quot;string&quot;,
  description: &quot;Brief summary of the image content (1 sentence)&quot;,
  max_length: 200,
  required: true
}

# Multi-modal summary
summary: {
  type: &quot;string&quot;,
  description: &quot;Overall summary combining all content types in the document&quot;,
  max_length: 600,
  required: true
}
</code></pre>
<h4 id="keyword-extraction">Keyword Extraction</h4>
<pre><code class="language-ruby"># Standard keyword field (all content types)
keywords: {
  type: &quot;array&quot;,
  items: { type: &quot;string&quot; },
  description: &quot;Relevant keywords and phrases extracted from content&quot;,
  maxItems: 10,
  minItems: 3,
  required: true,
  validation: {
    min_word_length: 3,
    no_stopwords: true,
    unique_only: true
  }
}

# Enhanced keywords with confidence scores
keywords_enhanced: {
  type: &quot;array&quot;,
  items: {
    type: &quot;object&quot;,
    properties: {
      term: { type: &quot;string&quot; },
      confidence: { type: &quot;number&quot;, minimum: 0, maximum: 1 },
      category: { type: &quot;string&quot;, enum: %w[concept entity action descriptor] }
    }
  },
  maxItems: 15
}
</code></pre>
<h4 id="topic-classification">Topic Classification</h4>
<pre><code class="language-ruby"># Primary classification
classification: {
  type: &quot;string&quot;,
  enum: {
    text: %w[research article blog documentation technical legal financial marketing other],
    image: %w[technical diagram photo artwork chart screenshot document other],
    audio: %w[educational entertainment business technical musical interview podcast other],
    pdf: %w[academic business legal technical manual report presentation other]
  },
  required: true
}

# Detailed topics array
topics: {
  type: &quot;array&quot;,
  items: { type: &quot;string&quot; },
  description: &quot;Main topics discussed in the document&quot;,
  maxItems: 5,
  validation: {
    hierarchical: true,  # Support parent::child topic structure
    taxonomy_validation: true
  }
}

# Classification confidence
classification_confidence: {
  type: &quot;number&quot;,
  minimum: 0,
  maximum: 1,
  description: &quot;Confidence score for the assigned classification&quot;
}
</code></pre>
<h4 id="sentiment-analysis">Sentiment Analysis</h4>
<pre><code class="language-ruby"># Basic sentiment (text content)
sentiment: {
  type: &quot;string&quot;,
  enum: %w[positive negative neutral mixed],
  description: &quot;Overall sentiment of the text&quot;
}

# Detailed sentiment analysis
sentiment_detailed: {
  type: &quot;object&quot;,
  properties: {
    overall: { type: &quot;string&quot;, enum: %w[positive negative neutral mixed] },
    confidence: { type: &quot;number&quot;, minimum: 0, maximum: 1 },
    emotional_tone: {
      type: &quot;array&quot;,
      items: { type: &quot;string&quot; },
      enum: %w[joy sadness anger fear disgust surprise trust anticipation]
    },
    subjectivity: { type: &quot;string&quot;, enum: %w[objective subjective] }
  }
}

# Mood for images and audio
mood: {
  type: &quot;string&quot;,
  enum: {
    image: %w[professional casual formal technical artistic dramatic serene energetic other],
    audio: %w[formal casual energetic calm professional educational entertaining informative other]
  },
  description: &quot;Overall mood or tone of the content&quot;
}
</code></pre>
<h4 id="content-categorization">Content Categorization</h4>
<pre><code class="language-ruby"># Complexity assessment
complexity_level: {
  type: &quot;string&quot;,
  enum: %w[beginner intermediate advanced expert],
  description: &quot;Complexity/difficulty level of the content&quot;,
  scoring_criteria: {
    beginner: &quot;Basic concepts, simple language, introductory material&quot;,
    intermediate: &quot;Some specialized knowledge required, moderate complexity&quot;,
    advanced: &quot;Specialized knowledge required, complex concepts&quot;,
    expert: &quot;Deep expertise required, highly technical content&quot;
  }
}

# Reading time estimation
reading_time_minutes: {
  type: &quot;integer&quot;,
  minimum: 1,
  maximum: 600,  # 10 hours max
  description: &quot;Estimated reading time in minutes&quot;,
  calculation: &quot;Based on 200-250 words per minute average reading speed&quot;
}

# Language detection
language: {
  type: &quot;string&quot;,
  pattern: &quot;^[a-z]{2}(-[A-Z]{2})?$&quot;,  # ISO 639-1 format
  description: &quot;Primary language of the content&quot;,
  examples: [&quot;en&quot;, &quot;es&quot;, &quot;fr&quot;, &quot;de&quot;, &quot;zh-CN&quot;]
}

# User-defined tags
tags: {
  type: &quot;array&quot;,
  items: { type: &quot;string&quot; },
  description: &quot;User-defined or AI-suggested tags for organization&quot;,
  maxItems: 20,
  validation: {
    no_spaces: false,  # Allow multi-word tags
    lowercase: true,
    unique_only: true
  }
}
</code></pre>
<h3 id="technical-metadata">Technical Metadata</h3>
<h4 id="processing-parameters">Processing Parameters</h4>
<pre><code class="language-ruby"># Content processing metadata (stored in file_metadata)
processing_metadata: {
  extraction_method: { type: &quot;string&quot; },  # &quot;pdf-reader&quot;, &quot;docx&quot;, &quot;image-magick&quot;
  processing_time_ms: { type: &quot;integer&quot; },
  embedding_model: { type: &quot;string&quot; },
  embedding_dimensions: { type: &quot;integer&quot; },
  chunk_count: { type: &quot;integer&quot; },
  chunk_strategy: { type: &quot;string&quot; },
  content_hash: { type: &quot;string&quot; },  # For change detection
  last_processed_at: { type: &quot;string&quot;, format: &quot;date-time&quot; }
}
</code></pre>
<h4 id="quality-metrics">Quality Metrics</h4>
<pre><code class="language-ruby"># Content quality assessment
quality_metrics: {
  content_completeness: { type: &quot;number&quot;, minimum: 0, maximum: 1 },
  extraction_confidence: { type: &quot;number&quot;, minimum: 0, maximum: 1 },
  metadata_completeness: { type: &quot;number&quot;, minimum: 0, maximum: 1 },
  validation_score: { type: &quot;number&quot;, minimum: 0, maximum: 1 },
  overall_quality: { type: &quot;number&quot;, minimum: 0, maximum: 1 }
}
</code></pre>
<h4 id="performance-data">Performance Data</h4>
<pre><code class="language-ruby"># Performance tracking metadata
performance_data: {
  file_size_bytes: { type: &quot;integer&quot; },
  processing_duration_ms: { type: &quot;integer&quot; },
  embedding_generation_time_ms: { type: &quot;integer&quot; },
  metadata_generation_time_ms: { type: &quot;integer&quot; },
  memory_usage_mb: { type: &quot;number&quot; },
  cpu_usage_percent: { type: &quot;number&quot; },
  api_calls_made: { type: &quot;integer&quot; },
  cost_estimate_usd: { type: &quot;number&quot; }
}
</code></pre>
<h2 id="schema-validation">Schema Validation</h2>
<p>Ragdoll implements comprehensive validation to ensure metadata quality and consistency:</p>
<h3 id="validation-rules">Validation Rules</h3>
<h4 id="required-fields-validation">Required Fields Validation</h4>
<pre><code class="language-ruby"># Schema-based required field checking
def self.validate_metadata(document_type, metadata)
  schema = schema_for(document_type)
  required_fields = schema[:required] || []
  errors = []

  required_fields.each do |field|
    unless metadata.key?(field) &amp;&amp; !metadata[field].to_s.strip.empty?
      errors &lt;&lt; &quot;Missing required field: #{field}&quot;
    end
  end

  errors
end

# Content-specific required fields
TEXT_SCHEMA[:required] = %w[summary keywords classification]
IMAGE_SCHEMA[:required] = %w[description summary scene_type classification]
AUDIO_SCHEMA[:required] = %w[summary content_type classification]
PDF_SCHEMA[:required] = %w[summary document_type classification]
MIXED_SCHEMA[:required] = %w[summary content_types primary_content_type classification]
</code></pre>
<h4 id="data-type-constraints">Data Type Constraints</h4>
<pre><code class="language-ruby"># Type validation with coercion
class MetadataValidator
  def self.validate_field_type(field_name, value, field_schema)
    expected_type = field_schema[:type]

    case expected_type
    when 'string'
      validate_string_field(field_name, value, field_schema)
    when 'array'
      validate_array_field(field_name, value, field_schema)
    when 'integer'
      validate_integer_field(field_name, value, field_schema)
    when 'number'
      validate_number_field(field_name, value, field_schema)
    when 'boolean'
      validate_boolean_field(field_name, value, field_schema)
    when 'object'
      validate_object_field(field_name, value, field_schema)
    else
      [&quot;Unknown field type: #{expected_type}&quot;]
    end
  end

  private

  def self.validate_string_field(field_name, value, schema)
    errors = []

    unless value.is_a?(String)
      return [&quot;#{field_name} must be a string, got #{value.class}&quot;]
    end

    # Length constraints
    if schema[:minLength] &amp;&amp; value.length &lt; schema[:minLength]
      errors &lt;&lt; &quot;#{field_name} must be at least #{schema[:minLength]} characters&quot;
    end

    if schema[:maxLength] &amp;&amp; value.length &gt; schema[:maxLength]
      errors &lt;&lt; &quot;#{field_name} must be no more than #{schema[:maxLength]} characters&quot;
    end

    # Enum validation
    if schema[:enum] &amp;&amp; !schema[:enum].include?(value)
      errors &lt;&lt; &quot;#{field_name} must be one of: #{schema[:enum].join(', ')}&quot;
    end

    # Pattern validation
    if schema[:pattern] &amp;&amp; !value.match?(Regexp.new(schema[:pattern]))
      errors &lt;&lt; &quot;#{field_name} does not match required pattern&quot;
    end

    errors
  end
end
</code></pre>
<h4 id="format-validation">Format Validation</h4>
<pre><code class="language-ruby"># Specialized format validators
class FormatValidators
  # Language code validation (ISO 639-1)
  def self.validate_language_code(code)
    valid_codes = %w[en es fr de it pt ru ja ko zh ar hi]
    return true if valid_codes.include?(code)
    return true if code.match?(/^[a-z]{2}-[A-Z]{2}$/)  # en-US format
    false
  end

  # Keyword validation
  def self.validate_keywords(keywords)
    errors = []

    return [&quot;Keywords must be an array&quot;] unless keywords.is_a?(Array)

    keywords.each_with_index do |keyword, index|
      unless keyword.is_a?(String)
        errors &lt;&lt; &quot;Keyword at index #{index} must be a string&quot;
        next
      end

      if keyword.length &lt; 3
        errors &lt;&lt; &quot;Keyword '#{keyword}' must be at least 3 characters&quot;
      end

      if keyword.length &gt; 50
        errors &lt;&lt; &quot;Keyword '#{keyword}' must be no more than 50 characters&quot;
      end

      if keyword.match?(/^\d+$/)  # Only numbers
        errors &lt;&lt; &quot;Keyword '#{keyword}' cannot be only numbers&quot;
      end
    end

    # Check for duplicates
    duplicates = keywords.group_by(&amp;:downcase).select { |k, v| v.size &gt; 1 }.keys
    if duplicates.any?
      errors &lt;&lt; &quot;Duplicate keywords found: #{duplicates.join(', ')}&quot;
    end

    errors
  end

  # URL validation for image sources
  def self.validate_url(url)
    return true if url.nil? || url.empty?

    begin
      uri = URI.parse(url)
      uri.is_a?(URI::HTTP) || uri.is_a?(URI::HTTPS)
    rescue URI::InvalidURIError
      false
    end
  end
end
</code></pre>
<h4 id="range-constraints">Range Constraints</h4>
<pre><code class="language-ruby"># Numeric range validation
class RangeValidator
  def self.validate_reading_time(minutes)
    errors = []

    unless minutes.is_a?(Integer)
      return [&quot;Reading time must be an integer&quot;]
    end

    if minutes &lt; 1
      errors &lt;&lt; &quot;Reading time must be at least 1 minute&quot;
    end

    if minutes &gt; 600  # 10 hours
      errors &lt;&lt; &quot;Reading time cannot exceed 600 minutes (10 hours)&quot;
    end

    # Warn for unusual values
    if minutes &gt; 120  # 2 hours
      errors &lt;&lt; &quot;Warning: Reading time of #{minutes} minutes seems unusually high&quot;
    end

    errors
  end

  def self.validate_confidence_score(score)
    return [&quot;Confidence score must be a number&quot;] unless score.is_a?(Numeric)
    return [&quot;Confidence score must be between 0 and 1&quot;] unless (0..1).cover?(score)
    []
  end
end
</code></pre>
<h3 id="error-handling">Error Handling</h3>
<h4 id="validation-error-reporting">Validation Error Reporting</h4>
<pre><code class="language-ruby">class ValidationErrorReporter
  def self.generate_detailed_report(document_type, metadata, errors)
    {
      document_type: document_type,
      validation_status: errors.empty? ? 'passed' : 'failed',
      error_count: errors.length,
      errors: errors.map { |error| format_error(error) },
      metadata_completeness: calculate_completeness(document_type, metadata),
      suggestions: generate_suggestions(document_type, errors),
      schema_version: get_schema_version(document_type)
    }
  end

  private

  def self.format_error(error)
    {
      message: error,
      severity: determine_severity(error),
      field: extract_field_name(error),
      suggestion: suggest_fix(error)
    }
  end

  def self.determine_severity(error)
    case error
    when /Missing required field/
      'critical'
    when /must be one of/
      'error'
    when /Warning:/
      'warning'
    else
      'error'
    end
  end
end
</code></pre>
<h4 id="schema-compatibility-checking">Schema Compatibility Checking</h4>
<pre><code class="language-ruby">class SchemaCompatibilityChecker
  def self.check_compatibility(old_metadata, new_schema)
    compatibility_report = {
      compatible: true,
      issues: [],
      migration_required: false,
      breaking_changes: []
    }

    # Check for removed required fields
    old_schema = infer_schema_from_metadata(old_metadata)
    new_required = new_schema[:required] || []
    old_required = old_schema[:required] || []

    removed_required = old_required - new_required
    added_required = new_required - old_required

    if removed_required.any?
      compatibility_report[:issues] &lt;&lt; {
        type: 'removed_required_fields',
        fields: removed_required,
        impact: 'breaking_change'
      }
      compatibility_report[:compatible] = false
    end

    if added_required.any?
      compatibility_report[:issues] &lt;&lt; {
        type: 'new_required_fields',
        fields: added_required,
        impact: 'migration_required'
      }
      compatibility_report[:migration_required] = true
    end

    compatibility_report
  end
end
</code></pre>
<h4 id="fallback-strategies">Fallback Strategies</h4>
<pre><code class="language-ruby">class MetadataFallbackHandler
  def self.apply_fallbacks(document_type, invalid_metadata, errors)
    fallback_metadata = invalid_metadata.dup

    errors.each do |error|
      case error
      when /Missing required field: summary/
        fallback_metadata['summary'] = generate_fallback_summary(invalid_metadata)
      when /Missing required field: keywords/
        fallback_metadata['keywords'] = extract_fallback_keywords(invalid_metadata)
      when /Missing required field: classification/
        fallback_metadata['classification'] = infer_classification(document_type, invalid_metadata)
      when /Invalid language code/
        fallback_metadata['language'] = 'en'  # Default to English
      when /Reading time.*unreasonable/
        fallback_metadata['reading_time_minutes'] = estimate_reading_time(invalid_metadata)
      end
    end

    # Re-validate with fallbacks applied
    new_errors = validate_metadata(document_type, fallback_metadata)

    {
      fallback_metadata: fallback_metadata,
      remaining_errors: new_errors,
      fallbacks_applied: errors.length - new_errors.length
    }
  end

  private

  def self.generate_fallback_summary(metadata)
    # Generate basic summary from available content
    if metadata['description']
      metadata['description'][0..200] + (metadata['description'].length &gt; 200 ? '...' : '')
    elsif metadata['title']
      &quot;Document: #{metadata['title']}&quot;
    else
      &quot;Content summary not available&quot;
    end
  end
end
</code></pre>
<h4 id="quality-thresholds">Quality Thresholds</h4>
<pre><code class="language-ruby">class QualityThresholdManager
  QUALITY_THRESHOLDS = {
    minimum_acceptable: 0.6,
    good_quality: 0.8,
    excellent_quality: 0.95
  }.freeze

  def self.assess_metadata_quality(document_type, metadata)
    schema = MetadataSchemas.schema_for(document_type)
    total_possible_fields = schema[:properties].keys.length

    scores = {
      completeness: calculate_completeness_score(metadata, schema),
      accuracy: calculate_accuracy_score(metadata, schema),
      richness: calculate_richness_score(metadata, schema),
      consistency: calculate_consistency_score(metadata)
    }

    overall_score = (
      scores[:completeness] * 0.3 +
      scores[:accuracy] * 0.4 +
      scores[:richness] * 0.2 +
      scores[:consistency] * 0.1
    )

    {
      overall_score: overall_score,
      quality_level: determine_quality_level(overall_score),
      component_scores: scores,
      meets_threshold: overall_score &gt;= QUALITY_THRESHOLDS[:minimum_acceptable],
      recommendations: generate_quality_recommendations(overall_score, scores)
    }
  end
end
</code></pre>
<h2 id="custom-schemas">Custom Schemas</h2>
<p>Ragdoll supports creating custom metadata schemas for specialized content types and domain-specific requirements:</p>
<h3 id="schema-definition">Schema Definition</h3>
<h4 id="json-schema-format">JSON Schema Format</h4>
<pre><code class="language-ruby"># Custom schema for legal documents
LEGAL_DOCUMENT_SCHEMA = {
  type: &quot;object&quot;,
  schema_version: &quot;1.0.0&quot;,
  schema_id: &quot;legal_document_v1&quot;,
  description: &quot;Metadata schema for legal documents and contracts&quot;,

  properties: {
    # Required base fields (inherited)
    summary: {
      type: &quot;string&quot;,
      description: &quot;Legal document summary focusing on key provisions&quot;,
      minLength: 100,
      maxLength: 1000
    },

    # Legal-specific fields
    document_type: {
      type: &quot;string&quot;,
      enum: %w[contract agreement policy statute regulation ordinance brief motion other],
      description: &quot;Type of legal document&quot;
    },

    jurisdiction: {
      type: &quot;string&quot;,
      description: &quot;Legal jurisdiction (e.g., 'US-CA', 'UK', 'EU')&quot;,
      pattern: &quot;^[A-Z]{2}(-[A-Z]{2})?$&quot;
    },

    legal_areas: {
      type: &quot;array&quot;,
      items: {
        type: &quot;string&quot;,
        enum: %w[contract corporate employment intellectual_property real_estate family criminal civil other]
      },
      maxItems: 5,
      description: &quot;Areas of law covered by this document&quot;
    },

    parties: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          name: { type: &quot;string&quot; },
          role: { type: &quot;string&quot;, enum: %w[plaintiff defendant buyer seller lessor lessee employer employee other] },
          entity_type: { type: &quot;string&quot;, enum: %w[individual corporation llc partnership government other] }
        },
        required: %w[name role]
      },
      maxItems: 10
    },

    effective_date: {
      type: &quot;string&quot;,
      format: &quot;date&quot;,
      description: &quot;Date when the document becomes effective&quot;
    },

    expiration_date: {
      type: &quot;string&quot;,
      format: &quot;date&quot;,
      description: &quot;Date when the document expires (if applicable)&quot;
    },

    key_terms: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          term: { type: &quot;string&quot; },
          definition: { type: &quot;string&quot; },
          importance: { type: &quot;string&quot;, enum: %w[critical important standard] }
        },
        required: %w[term definition]
      },
      maxItems: 20
    },

    compliance_requirements: {
      type: &quot;array&quot;,
      items: { type: &quot;string&quot; },
      description: &quot;Regulatory or legal compliance requirements&quot;
    },

    risk_level: {
      type: &quot;string&quot;,
      enum: %w[low medium high critical],
      description: &quot;Risk assessment level for the document&quot;
    }
  },

  required: %w[summary document_type jurisdiction legal_areas],

  # Custom validation rules
  custom_validators: %w[validate_jurisdiction_format validate_date_consistency validate_party_roles],

  # Schema metadata
  created_by: &quot;Legal Team&quot;,
  created_at: &quot;2024-01-15&quot;,
  compatible_with: [&quot;base_schema_v1&quot;],
  extends: &quot;base_document_schema&quot;
}.freeze
</code></pre>
<h4 id="field-type-definitions">Field Type Definitions</h4>
<pre><code class="language-ruby"># Extended field type system
CUSTOM_FIELD_TYPES = {
  # Geographic types
  &quot;coordinates&quot; =&gt; {
    type: &quot;object&quot;,
    properties: {
      latitude: { type: &quot;number&quot;, minimum: -90, maximum: 90 },
      longitude: { type: &quot;number&quot;, minimum: -180, maximum: 180 }
    },
    required: %w[latitude longitude]
  },

  # Monetary types
  &quot;currency_amount&quot; =&gt; {
    type: &quot;object&quot;,
    properties: {
      amount: { type: &quot;number&quot;, minimum: 0 },
      currency: { type: &quot;string&quot;, pattern: &quot;^[A-Z]{3}$&quot; },  # ISO 4217
      formatted: { type: &quot;string&quot; }
    },
    required: %w[amount currency]
  },

  # Person/entity types
  &quot;person&quot; =&gt; {
    type: &quot;object&quot;,
    properties: {
      name: { type: &quot;string&quot; },
      email: { type: &quot;string&quot;, format: &quot;email&quot; },
      role: { type: &quot;string&quot; },
      organization: { type: &quot;string&quot; }
    },
    required: %w[name]
  },

  # Date range types
  &quot;date_range&quot; =&gt; {
    type: &quot;object&quot;,
    properties: {
      start_date: { type: &quot;string&quot;, format: &quot;date&quot; },
      end_date: { type: &quot;string&quot;, format: &quot;date&quot; },
      duration_days: { type: &quot;integer&quot;, minimum: 0 }
    },
    required: %w[start_date end_date]
  }
}.freeze
</code></pre>
<h4 id="validation-rule-specification">Validation Rule Specification</h4>
<pre><code class="language-ruby"># Custom validation rules for specialized schemas
class CustomValidators
  def self.validate_jurisdiction_format(value)
    # US state codes, country codes, or international codes
    valid_patterns = [
      /^US-[A-Z]{2}$/,    # US-CA, US-NY
      /^[A-Z]{2}$/,       # US, UK, DE
      /^EU$/,             # European Union
      /^UN$/              # United Nations
    ]

    return [] if valid_patterns.any? { |pattern| value.match?(pattern) }
    [&quot;Invalid jurisdiction format: #{value}&quot;]
  end

  def self.validate_date_consistency(metadata)
    errors = []

    if metadata['effective_date'] &amp;&amp; metadata['expiration_date']
      effective = Date.parse(metadata['effective_date'])
      expiration = Date.parse(metadata['expiration_date'])

      if effective &gt; expiration
        errors &lt;&lt; &quot;Effective date cannot be after expiration date&quot;
      end

      if expiration &lt; Date.current
        errors &lt;&lt; &quot;Warning: Document appears to be expired&quot;
      end
    end

    errors
  rescue Date::Error
    [&quot;Invalid date format in date fields&quot;]
  end

  def self.validate_party_roles(parties)
    return [] unless parties.is_a?(Array)

    errors = []
    role_counts = parties.group_by { |p| p['role'] }.transform_values(&amp;:count)

    # Business logic validation
    if role_counts['buyer'] &amp;&amp; role_counts['seller']
      unless role_counts['buyer'] == role_counts['seller']
        errors &lt;&lt; &quot;Number of buyers must equal number of sellers in transaction&quot;
      end
    end

    # Check for conflicting roles
    parties.each do |party|
      name = party['name']
      conflicting_parties = parties.select { |p| p['name'] == name &amp;&amp; p['role'] != party['role'] }

      if conflicting_parties.any?
        errors &lt;&lt; &quot;Party '#{name}' has conflicting roles: #{[party['role']] + conflicting_parties.map { |p| p['role'] }}&quot;
      end
    end

    errors
  end
end
</code></pre>
<h4 id="documentation-requirements">Documentation Requirements</h4>
<pre><code class="language-ruby"># Schema documentation template
SCHEMA_DOCUMENTATION_TEMPLATE = {
  schema_info: {
    name: &quot;Legal Document Schema&quot;,
    version: &quot;1.0.0&quot;,
    description: &quot;Comprehensive metadata schema for legal documents&quot;,
    use_cases: [
      &quot;Contract analysis and management&quot;,
      &quot;Legal compliance tracking&quot;,
      &quot;Document classification and search&quot;
    ],
    target_documents: [&quot;contracts&quot;, &quot;agreements&quot;, &quot;policies&quot;, &quot;regulations&quot;]
  },

  field_documentation: {
    &quot;jurisdiction&quot; =&gt; {
      description: &quot;Legal jurisdiction where document applies&quot;,
      examples: [&quot;US-CA&quot;, &quot;UK&quot;, &quot;EU&quot;],
      validation_notes: &quot;Must follow ISO country codes or US state format&quot;,
      business_impact: &quot;Critical for determining applicable laws and regulations&quot;
    },

    &quot;parties&quot; =&gt; {
      description: &quot;All parties involved in the legal document&quot;,
      examples: [
        { name: &quot;Acme Corp&quot;, role: &quot;buyer&quot;, entity_type: &quot;corporation&quot; },
        { name: &quot;John Smith&quot;, role: &quot;seller&quot;, entity_type: &quot;individual&quot; }
      ],
      validation_notes: &quot;Must include name and role for each party&quot;,
      business_impact: &quot;Essential for contract management and obligation tracking&quot;
    }
  },

  usage_guidelines: {
    best_practices: [
      &quot;Always validate jurisdiction format before processing&quot;,
      &quot;Include all parties mentioned in the document&quot;,
      &quot;Use standardized role names for consistency&quot;
    ],
    common_mistakes: [
      &quot;Forgetting to include all parties&quot;,
      &quot;Using non-standard jurisdiction codes&quot;,
      &quot;Inconsistent date formats&quot;
    ]
  }
}.freeze
</code></pre>
<h3 id="schema-registration">Schema Registration</h3>
<h4 id="schema-loading-mechanisms">Schema Loading Mechanisms</h4>
<pre><code class="language-ruby">class CustomSchemaRegistry
  @@registered_schemas = {}
  @@schema_versions = {}

  def self.register_schema(schema_id, schema_definition)
    validate_schema_format!(schema_definition)

    version = schema_definition[:schema_version] || '1.0.0'

    @@registered_schemas[schema_id] = schema_definition
    @@schema_versions[schema_id] ||= []
    @@schema_versions[schema_id] &lt;&lt; version

    # Register custom validators if present
    if schema_definition[:custom_validators]
      register_custom_validators(schema_id, schema_definition[:custom_validators])
    end

    Rails.logger.info &quot;Registered custom schema: #{schema_id} v#{version}&quot;
  end

  def self.load_schemas_from_directory(directory_path)
    Dir.glob(File.join(directory_path, '*.rb')).each do |schema_file|
      load_schema_file(schema_file)
    end
  end

  def self.get_schema(schema_id, version: 'latest')
    base_schema = @@registered_schemas[schema_id]
    return nil unless base_schema

    if version == 'latest'
      base_schema
    else
      get_schema_version(schema_id, version)
    end
  end

  private

  def self.validate_schema_format!(schema)
    required_keys = %w[type properties required]
    missing_keys = required_keys - schema.keys.map(&amp;:to_s)

    if missing_keys.any?
      raise &quot;Schema missing required keys: #{missing_keys.join(', ')}&quot;
    end

    unless schema[:type] == 'object'
      raise &quot;Schema type must be 'object', got '#{schema[:type]}'&quot;
    end
  end
end

# Usage
CustomSchemaRegistry.register_schema('legal_document', LEGAL_DOCUMENT_SCHEMA)
CustomSchemaRegistry.load_schemas_from_directory(Rails.root.join('config', 'schemas'))
</code></pre>
<h4 id="version-management">Version Management</h4>
<pre><code class="language-ruby">class SchemaVersionManager
  def self.create_new_version(schema_id, updates)
    current_schema = CustomSchemaRegistry.get_schema(schema_id)
    return nil unless current_schema

    current_version = current_schema[:schema_version] || '1.0.0'
    new_version = increment_version(current_version, updates[:breaking_changes])

    new_schema = current_schema.deep_merge(updates).merge(
      schema_version: new_version,
      previous_version: current_version,
      migration_guide: generate_migration_guide(current_schema, updates)
    )

    CustomSchemaRegistry.register_schema(&quot;#{schema_id}_v#{new_version.gsub('.', '_')}&quot;, new_schema)

    new_schema
  end

  def self.increment_version(current_version, has_breaking_changes)
    major, minor, patch = current_version.split('.').map(&amp;:to_i)

    if has_breaking_changes
      &quot;#{major + 1}.0.0&quot;
    elsif updates[:new_fields]&amp;.any?
      &quot;#{major}.#{minor + 1}.0&quot;
    else
      &quot;#{major}.#{minor}.#{patch + 1}&quot;
    end
  end
end
</code></pre>
<h4 id="migration-strategies">Migration Strategies</h4>
<pre><code class="language-ruby">class SchemaMigrator
  def self.migrate_metadata(old_metadata, from_schema, to_schema)
    migration_plan = create_migration_plan(from_schema, to_schema)
    migrated_metadata = old_metadata.dup

    migration_plan[:field_mappings].each do |old_field, new_field|
      if migrated_metadata.key?(old_field)
        migrated_metadata[new_field] = migrated_metadata.delete(old_field)
      end
    end

    migration_plan[:field_transformations].each do |field, transformer|
      if migrated_metadata.key?(field)
        migrated_metadata[field] = apply_transformation(migrated_metadata[field], transformer)
      end
    end

    migration_plan[:default_values].each do |field, default|
      migrated_metadata[field] ||= default
    end

    {
      migrated_metadata: migrated_metadata,
      migration_warnings: validate_migrated_metadata(migrated_metadata, to_schema),
      migration_log: migration_plan[:log]
    }
  end
end
</code></pre>
<h2 id="domain-specific-schemas">Domain-Specific Schemas</h2>
<p>Ragdoll provides specialized schemas for common document domains:</p>
<h3 id="academic-papers">Academic Papers</h3>
<h4 id="citation-extraction-schema">Citation Extraction Schema</h4>
<pre><code class="language-ruby">ACADEMIC_PAPER_SCHEMA = {
  type: &quot;object&quot;,
  properties: {
    # Standard fields
    summary: {
      type: &quot;string&quot;,
      description: &quot;Abstract or executive summary of the research&quot;
    },

    # Academic-specific fields
    paper_type: {
      type: &quot;string&quot;,
      enum: %w[research_paper review_article conference_paper thesis dissertation preprint technical_report other],
      description: &quot;Type of academic document&quot;
    },

    research_areas: {
      type: &quot;array&quot;,
      items: { type: &quot;string&quot; },
      description: &quot;Research disciplines and fields covered&quot;,
      maxItems: 5
    },

    authors: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          name: { type: &quot;string&quot; },
          affiliation: { type: &quot;string&quot; },
          email: { type: &quot;string&quot;, format: &quot;email&quot; },
          orcid: { type: &quot;string&quot;, pattern: &quot;^\\d{4}-\\d{4}-\\d{4}-\\d{3}[0-9X]$&quot; },
          corresponding_author: { type: &quot;boolean&quot; }
        },
        required: %w[name]
      },
      minItems: 1
    },

    publication_info: {
      type: &quot;object&quot;,
      properties: {
        journal: { type: &quot;string&quot; },
        conference: { type: &quot;string&quot; },
        volume: { type: &quot;string&quot; },
        issue: { type: &quot;string&quot; },
        pages: { type: &quot;string&quot; },
        publication_date: { type: &quot;string&quot;, format: &quot;date&quot; },
        doi: { type: &quot;string&quot;, pattern: &quot;^10\\.\\d+/.+&quot; },
        isbn: { type: &quot;string&quot; },
        publisher: { type: &quot;string&quot; }
      }
    },

    citations: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          title: { type: &quot;string&quot; },
          authors: { type: &quot;string&quot; },
          year: { type: &quot;integer&quot;, minimum: 1900, maximum: 2030 },
          source: { type: &quot;string&quot; },
          doi: { type: &quot;string&quot; },
          citation_type: { type: &quot;string&quot;, enum: %w[foundational supportive comparative critical methodological] }
        },
        required: %w[title authors year]
      }
    },

    methodology: {
      type: &quot;object&quot;,
      properties: {
        research_methods: {
          type: &quot;array&quot;,
          items: { type: &quot;string&quot;, enum: %w[experimental observational survey case_study meta_analysis theoretical computational qualitative quantitative mixed_methods] }
        },
        data_sources: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        sample_size: { type: &quot;integer&quot;, minimum: 0 },
        statistical_methods: { type: &quot;array&quot;, items: { type: &quot;string&quot; } }
      }
    },

    funding: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          agency: { type: &quot;string&quot; },
          grant_number: { type: &quot;string&quot; },
          amount: { type: &quot;number&quot; },
          currency: { type: &quot;string&quot; }
        },
        required: %w[agency]
      }
    },

    peer_review_status: {
      type: &quot;string&quot;,
      enum: %w[peer_reviewed non_peer_reviewed preprint under_review],
      description: &quot;Peer review status of the publication&quot;
    },

    impact_metrics: {
      type: &quot;object&quot;,
      properties: {
        citation_count: { type: &quot;integer&quot;, minimum: 0 },
        h_index_contribution: { type: &quot;number&quot; },
        altmetric_score: { type: &quot;number&quot; },
        download_count: { type: &quot;integer&quot;, minimum: 0 }
      }
    }
  },

  required: %w[summary paper_type research_areas authors]
}.freeze
</code></pre>
<h3 id="legal-documents">Legal Documents</h3>
<h4 id="legal-classification-schema">Legal Classification Schema</h4>
<pre><code class="language-ruby">LEGAL_DOCUMENT_SCHEMA = {
  type: &quot;object&quot;,
  properties: {
    # Standard fields adapted for legal content
    summary: {
      type: &quot;string&quot;,
      description: &quot;Legal summary focusing on key provisions and obligations&quot;,
      minLength: 100
    },

    # Legal-specific classification
    document_type: {
      type: &quot;string&quot;,
      enum: %w[contract agreement policy statute regulation ordinance brief motion pleading judgment settlement nda license other],
      description: &quot;Type of legal document&quot;
    },

    jurisdiction: {
      type: &quot;object&quot;,
      properties: {
        primary: { type: &quot;string&quot;, description: &quot;Primary jurisdiction (US-CA, UK, EU)&quot; },
        additional: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        court_level: { type: &quot;string&quot;, enum: %w[federal state local municipal international] }
      },
      required: %w[primary]
    },

    legal_areas: {
      type: &quot;array&quot;,
      items: {
        type: &quot;string&quot;,
        enum: %w[contract corporate employment intellectual_property real_estate family criminal civil tax immigration environmental securities banking healthcare privacy data_protection other]
      },
      maxItems: 5
    },

    parties: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          name: { type: &quot;string&quot; },
          role: {
            type: &quot;string&quot;,
            enum: %w[plaintiff defendant buyer seller lessor lessee employer employee licensor licensee grantor grantee other]
          },
          entity_type: {
            type: &quot;string&quot;,
            enum: %w[individual corporation llc partnership government nonprofit trust estate other]
          },
          representation: { type: &quot;string&quot;, description: &quot;Legal representation/counsel&quot; }
        },
        required: %w[name role entity_type]
      }
    },

    key_provisions: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          provision_type: {
            type: &quot;string&quot;,
            enum: %w[payment termination liability confidentiality indemnification warranty limitation_of_liability force_majeure governing_law dispute_resolution other]
          },
          description: { type: &quot;string&quot; },
          critical: { type: &quot;boolean&quot; },
          page_reference: { type: &quot;string&quot; }
        },
        required: %w[provision_type description]
      }
    },

    compliance_requirements: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          regulation: { type: &quot;string&quot; },
          requirement: { type: &quot;string&quot; },
          deadline: { type: &quot;string&quot;, format: &quot;date&quot; },
          responsible_party: { type: &quot;string&quot; },
          penalty: { type: &quot;string&quot; }
        },
        required: %w[regulation requirement]
      }
    },

    risk_analysis: {
      type: &quot;object&quot;,
      properties: {
        overall_risk_level: { type: &quot;string&quot;, enum: %w[low medium high critical] },
        financial_exposure: { type: &quot;string&quot; },
        operational_risks: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        legal_risks: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        mitigation_strategies: { type: &quot;array&quot;, items: { type: &quot;string&quot; } }
      }
    },

    important_dates: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          date: { type: &quot;string&quot;, format: &quot;date&quot; },
          description: { type: &quot;string&quot; },
          date_type: { type: &quot;string&quot;, enum: %w[effective_date expiration_date deadline milestone notification_date other] },
          recurring: { type: &quot;boolean&quot; },
          recurrence_pattern: { type: &quot;string&quot; }
        },
        required: %w[date description date_type]
      }
    }
  },

  required: %w[summary document_type jurisdiction legal_areas parties]
}.freeze
</code></pre>
<h3 id="technical-documentation">Technical Documentation</h3>
<h4 id="api-documentation-schema">API Documentation Schema</h4>
<pre><code class="language-ruby">TECHNICAL_DOCUMENTATION_SCHEMA = {
  type: &quot;object&quot;,
  properties: {
    # Standard technical fields
    summary: {
      type: &quot;string&quot;,
      description: &quot;Technical summary of the documentation content&quot;
    },

    documentation_type: {
      type: &quot;string&quot;,
      enum: %w[api_reference user_guide developer_guide installation_guide troubleshooting architecture_document code_documentation release_notes other],
      description: &quot;Type of technical documentation&quot;
    },

    # API-specific fields
    api_info: {
      type: &quot;object&quot;,
      properties: {
        api_name: { type: &quot;string&quot; },
        version: { type: &quot;string&quot;, pattern: &quot;^\\d+\\.\\d+\\.\\d+&quot; },
        base_url: { type: &quot;string&quot;, format: &quot;uri&quot; },
        authentication_methods: {
          type: &quot;array&quot;,
          items: { type: &quot;string&quot;, enum: %w[api_key oauth2 jwt basic_auth bearer_token none] }
        },
        supported_formats: {
          type: &quot;array&quot;,
          items: { type: &quot;string&quot;, enum: %w[json xml yaml csv] }
        },
        rate_limits: {
          type: &quot;object&quot;,
          properties: {
            requests_per_minute: { type: &quot;integer&quot; },
            requests_per_hour: { type: &quot;integer&quot; },
            requests_per_day: { type: &quot;integer&quot; }
          }
        }
      }
    },

    endpoints: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          path: { type: &quot;string&quot; },
          method: { type: &quot;string&quot;, enum: %w[GET POST PUT DELETE PATCH HEAD OPTIONS] },
          description: { type: &quot;string&quot; },
          parameters: {
            type: &quot;array&quot;,
            items: {
              type: &quot;object&quot;,
              properties: {
                name: { type: &quot;string&quot; },
                type: { type: &quot;string&quot; },
                required: { type: &quot;boolean&quot; },
                description: { type: &quot;string&quot; },
                example: { type: &quot;string&quot; }
              },
              required: %w[name type required]
            }
          },
          response_codes: {
            type: &quot;array&quot;,
            items: {
              type: &quot;object&quot;,
              properties: {
                code: { type: &quot;integer&quot; },
                description: { type: &quot;string&quot; },
                example: { type: &quot;string&quot; }
              }
            }
          }
        },
        required: %w[path method description]
      }
    },

    code_examples: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          language: { type: &quot;string&quot;, enum: %w[javascript python ruby java php curl bash other] },
          code: { type: &quot;string&quot; },
          description: { type: &quot;string&quot; },
          output_example: { type: &quot;string&quot; }
        },
        required: %w[language code]
      }
    },

    dependencies: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          name: { type: &quot;string&quot; },
          version: { type: &quot;string&quot; },
          type: { type: &quot;string&quot;, enum: %w[runtime development build peer optional] },
          purpose: { type: &quot;string&quot; },
          license: { type: &quot;string&quot; }
        },
        required: %w[name version type]
      }
    },

    version_info: {
      type: &quot;object&quot;,
      properties: {
        current_version: { type: &quot;string&quot; },
        supported_versions: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        deprecated_versions: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        version_history: {
          type: &quot;array&quot;,
          items: {
            type: &quot;object&quot;,
            properties: {
              version: { type: &quot;string&quot; },
              release_date: { type: &quot;string&quot;, format: &quot;date&quot; },
              changes: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
              breaking_changes: { type: &quot;boolean&quot; }
            }
          }
        }
      }
    },

    technical_requirements: {
      type: &quot;object&quot;,
      properties: {
        minimum_versions: {
          type: &quot;object&quot;,
          patternProperties: {
            &quot;.*&quot;: { type: &quot;string&quot; }  # e.g., &quot;node&quot;: &quot;&gt;=14.0.0&quot;, &quot;python&quot;: &quot;&gt;=3.8&quot;
          }
        },
        supported_platforms: {
          type: &quot;array&quot;,
          items: { type: &quot;string&quot;, enum: %w[windows macos linux docker kubernetes web mobile] }
        },
        hardware_requirements: {
          type: &quot;object&quot;,
          properties: {
            min_memory_mb: { type: &quot;integer&quot; },
            min_disk_space_mb: { type: &quot;integer&quot; },
            cpu_cores: { type: &quot;integer&quot; }
          }
        }
      }
    },

    troubleshooting: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          problem: { type: &quot;string&quot; },
          solution: { type: &quot;string&quot; },
          error_codes: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
          category: { type: &quot;string&quot;, enum: %w[installation configuration authentication authorization performance security other] }
        },
        required: %w[problem solution]
      }
    }
  },

  required: %w[summary documentation_type]
}.freeze
</code></pre>
<h4 id="code-documentation-schema">Code Documentation Schema</h4>
<pre><code class="language-ruby">CODE_DOCUMENTATION_SCHEMA = {
  type: &quot;object&quot;,
  properties: {
    summary: {
      type: &quot;string&quot;,
      description: &quot;Summary of the code functionality and purpose&quot;
    },

    code_type: {
      type: &quot;string&quot;,
      enum: %w[class function module library framework application script configuration other],
      description: &quot;Type of code being documented&quot;
    },

    programming_language: {
      type: &quot;string&quot;,
      enum: %w[javascript typescript python ruby java csharp cpp c php go rust swift kotlin scala other],
      description: &quot;Primary programming language&quot;
    },

    functions_and_methods: {
      type: &quot;array&quot;,
      items: {
        type: &quot;object&quot;,
        properties: {
          name: { type: &quot;string&quot; },
          description: { type: &quot;string&quot; },
          parameters: {
            type: &quot;array&quot;,
            items: {
              type: &quot;object&quot;,
              properties: {
                name: { type: &quot;string&quot; },
                type: { type: &quot;string&quot; },
                required: { type: &quot;boolean&quot; },
                default_value: { type: &quot;string&quot; },
                description: { type: &quot;string&quot; }
              }
            }
          },
          return_type: { type: &quot;string&quot; },
          return_description: { type: &quot;string&quot; },
          exceptions: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
          complexity: { type: &quot;string&quot;, enum: %w[O(1) O(log n) O(n) O(n log n) O(n) O(2^n) other] }
        },
        required: %w[name description]
      }
    },

    design_patterns: {
      type: &quot;array&quot;,
      items: { type: &quot;string&quot;, enum: %w[singleton factory observer strategy command adapter decorator facade mvc mvp mvvm repository unit_of_work other] }
    },

    testing_info: {
      type: &quot;object&quot;,
      properties: {
        test_coverage: { type: &quot;number&quot;, minimum: 0, maximum: 100 },
        testing_frameworks: { type: &quot;array&quot;, items: { type: &quot;string&quot; } },
        test_types: { type: &quot;array&quot;, items: { type: &quot;string&quot;, enum: %w[unit integration e2e performance security accessibility] } }
      }
    }
  },

  required: %w[summary code_type programming_language]
}.freeze
</code></pre>
<h2 id="llm-metadata-generation">LLM Metadata Generation</h2>
<p>Ragdoll uses advanced prompt engineering and LLM integration for high-quality metadata generation:</p>
<h3 id="generation-process">Generation Process</h3>
<h4 id="content-analysis-pipeline">Content Analysis Pipeline</h4>
<pre><code class="language-ruby">class MetadataGenerator
  def generate_for_document(document)
    content_analyzer = ContentAnalyzer.new(document)

    # Stage 1: Content preprocessing
    preprocessed_content = content_analyzer.preprocess

    # Stage 2: Schema selection
    schema = MetadataSchemas.schema_for(document.document_type)

    # Stage 3: Model selection
    model = select_optimal_model(document, schema)

    # Stage 4: Prompt generation
    prompt = generate_schema_aware_prompt(preprocessed_content, schema)

    # Stage 5: LLM generation
    raw_metadata = call_llm_with_retry(model, prompt)

    # Stage 6: Validation and cleanup
    validated_metadata = validate_and_clean(raw_metadata, schema)

    # Stage 7: Quality assessment
    quality_score = assess_metadata_quality(validated_metadata, schema)

    {
      metadata: validated_metadata,
      quality_score: quality_score,
      model_used: model,
      processing_time: Time.current - start_time
    }
  end
end
</code></pre>
<h4 id="model-selection-strategies">Model Selection Strategies</h4>
<pre><code class="language-ruby">class ModelSelector
  MODEL_CAPABILITIES = {
    'openai/gpt-4o' =&gt; {
      strengths: [:complex_analysis, :technical_content, :multilingual],
      optimal_for: [:academic_papers, :legal_documents, :technical_docs],
      cost: :high,
      speed: :medium,
      max_tokens: 128000
    },

    'openai/gpt-4o-mini' =&gt; {
      strengths: [:general_analysis, :speed, :cost_effective],
      optimal_for: [:text_documents, :simple_classification],
      cost: :low,
      speed: :fast,
      max_tokens: 128000
    },

    'anthropic/claude-3-sonnet-20240229' =&gt; {
      strengths: [:detailed_analysis, :accuracy, :reasoning],
      optimal_for: [:complex_documents, :legal_analysis],
      cost: :medium,
      speed: :medium,
      max_tokens: 200000
    },

    'anthropic/claude-3-haiku-20240307' =&gt; {
      strengths: [:speed, :simple_tasks, :cost_effective],
      optimal_for: [:keyword_extraction, :basic_classification],
      cost: :low,
      speed: :very_fast,
      max_tokens: 200000
    }
  }.freeze

  def self.select_optimal_model(document, schema)
    content_complexity = analyze_content_complexity(document)
    schema_complexity = analyze_schema_complexity(schema)

    # Score models based on document and schema requirements
    model_scores = MODEL_CAPABILITIES.map do |model, capabilities|
      score = 0

      # Content type optimization
      if capabilities[:optimal_for].include?(document.document_type.to_sym)
        score += 30
      end

      # Complexity matching
      case content_complexity
      when :high
        score += 20 if capabilities[:strengths].include?(:complex_analysis)
      when :medium
        score += 15 if capabilities[:cost] == :medium
      when :low
        score += 25 if capabilities[:speed] == :fast
      end

      # Schema complexity matching
      if schema_complexity == :high &amp;&amp; capabilities[:strengths].include?(:detailed_analysis)
        score += 15
      end

      # Cost optimization (configurable weight)
      cost_weight = Ragdoll.config.metadata_generation[:cost_optimization_weight] || 0.2
      case capabilities[:cost]
      when :low then score += (20 * cost_weight)
      when :medium then score += (10 * cost_weight)
      when :high then score -= (10 * cost_weight)
      end

      [model, score]
    end

    # Return the highest scoring model
    model_scores.max_by { |model, score| score }.first
  end
end
</code></pre>
<h4 id="quality-assessment">Quality Assessment</h4>
<pre><code class="language-ruby">class MetadataQualityAssessor
  def self.assess_quality(metadata, schema, original_content)
    scores = {
      completeness: assess_completeness(metadata, schema),
      accuracy: assess_accuracy(metadata, original_content),
      consistency: assess_consistency(metadata),
      relevance: assess_relevance(metadata, original_content),
      specificity: assess_specificity(metadata)
    }

    # Weighted overall score
    overall_score = (
      scores[:completeness] * 0.25 +
      scores[:accuracy] * 0.30 +
      scores[:consistency] * 0.15 +
      scores[:relevance] * 0.20 +
      scores[:specificity] * 0.10
    )

    {
      overall_score: overall_score,
      component_scores: scores,
      quality_level: determine_quality_level(overall_score),
      recommendations: generate_improvement_recommendations(scores)
    }
  end
end
</code></pre>
<h3 id="prompt-engineering">Prompt Engineering</h3>
<h4 id="schema-aware-prompts">Schema-Aware Prompts</h4>
<pre><code class="language-ruby">class SchemaAwarePromptBuilder
  def build_prompt(content, schema)
    prompt_parts = []

    # System instruction
    prompt_parts &lt;&lt; build_system_instruction(schema)

    # Schema specification
    prompt_parts &lt;&lt; build_schema_specification(schema)

    # Content context
    prompt_parts &lt;&lt; build_content_context(content)

    # Examples (few-shot learning)
    prompt_parts &lt;&lt; build_examples(schema)

    # Final instruction
    prompt_parts &lt;&lt; build_final_instruction(schema)

    prompt_parts.join(&quot;\n\n&quot;)
  end

  private

  def build_system_instruction(schema)
    &lt;&lt;~PROMPT
      You are an expert content analyst specializing in extracting structured metadata from documents.

      Your task is to analyze the provided content and generate metadata that strictly follows the given JSON schema.

      Key requirements:
      - All required fields must be present
      - Enum values must match exactly (case-sensitive)
      - Array fields must not exceed maxItems limits
      - Provide accurate, relevant, and specific information
      - If information is not available, use appropriate defaults or null values
      - Maintain consistency across related fields
    PROMPT
  end

  def build_schema_specification(schema)
    &lt;&lt;~PROMPT
      ## JSON Schema Specification

      ```json
      #{JSON.pretty_generate(schema)}
      ```

      Required fields: #{schema[:required]&amp;.join(', ') || 'none'}
    PROMPT
  end

  def build_content_context(content)
    # Truncate content if too long for model context
    truncated_content = truncate_for_model(content)

    &lt;&lt;~PROMPT
      ## Content to Analyze

      ```
      #{truncated_content}
      ```
    PROMPT
  end

  def build_examples(schema)
    example_metadata = generate_example_metadata(schema)

    &lt;&lt;~PROMPT
      ## Example Output Format

      ```json
      #{JSON.pretty_generate(example_metadata)}
      ```
    PROMPT
  end

  def build_final_instruction(schema)
    &lt;&lt;~PROMPT
      ## Instructions

      Analyze the provided content and generate metadata following the exact schema format.

      Return only valid JSON that matches the schema - no additional text or explanations.

      Focus on:
      #{build_focus_points(schema)}
    PROMPT
  end

  def build_focus_points(schema)
    focus_points = []

    schema[:properties].each do |field, field_schema|
      case field
      when :summary, &quot;summary&quot;
        focus_points &lt;&lt; &quot;- Create a concise, informative summary (#{field_schema[:description]})&quot;
      when :keywords, &quot;keywords&quot;
        focus_points &lt;&lt; &quot;- Extract relevant, specific keywords (max #{field_schema[:maxItems] || 10})&quot;
      when :classification, &quot;classification&quot;
        focus_points &lt;&lt; &quot;- Choose the most appropriate classification from: #{field_schema[:enum]&amp;.join(', ')}&quot;
      end
    end

    focus_points.join(&quot;\n&quot;)
  end
end
</code></pre>
<h4 id="consistency-optimization">Consistency Optimization</h4>
<pre><code class="language-ruby">class ConsistencyOptimizer
  def self.optimize_for_consistency(prompt, previous_metadata = nil)
    optimized_prompt = prompt.dup

    if previous_metadata
      # Add consistency instruction
      consistency_instruction = build_consistency_instruction(previous_metadata)
      optimized_prompt += &quot;\n\n#{consistency_instruction}&quot;
    end

    # Add terminology consistency rules
    optimized_prompt += &quot;\n\n#{build_terminology_rules}&quot;

    optimized_prompt
  end

  private

  def self.build_consistency_instruction(previous_metadata)
    &lt;&lt;~INSTRUCTION
      ## Consistency Requirements

      Maintain consistency with previously generated metadata:

      - Use similar classification categories when appropriate
      - Maintain consistent keyword terminology
      - Keep similar complexity levels for related content
      - Use consistent language and tone in summaries

      Previous metadata reference:
      ```json
      #{JSON.pretty_generate(previous_metadata.sample(3))}  # Sample for reference
      ```
    INSTRUCTION
  end

  def self.build_terminology_rules
    &lt;&lt;~RULES
      ## Terminology Standards

      - Use consistent technical terms (e.g., &quot;API&quot; not &quot;api&quot; or &quot;Api&quot;)
      - Standardize compound terms (e.g., &quot;machine learning&quot; not &quot;machine-learning&quot;)
      - Use full forms for important concepts (e.g., &quot;artificial intelligence&quot; before &quot;AI&quot;)
      - Maintain consistent capitalization in proper nouns
      - Use industry-standard terminology when available
    RULES
  end
end
</code></pre>
<h4 id="error-reduction-techniques">Error Reduction Techniques</h4>
<pre><code class="language-ruby">class ErrorReductionStrategies
  def self.apply_error_reduction(prompt, schema)
    enhanced_prompt = prompt.dup

    # Add common error prevention
    enhanced_prompt += &quot;\n\n#{build_error_prevention_rules(schema)}&quot;

    # Add validation reminders
    enhanced_prompt += &quot;\n\n#{build_validation_reminders(schema)}&quot;

    enhanced_prompt
  end

  private

  def self.build_error_prevention_rules(schema)
    rules = []

    # Enum validation rules
    enum_fields = schema[:properties].select { |k, v| v[:enum] }
    if enum_fields.any?
      rules &lt;&lt; &quot;CRITICAL: Enum fields must use exact values from the schema:&quot;
      enum_fields.each do |field, field_schema|
        rules &lt;&lt; &quot;- #{field}: #{field_schema[:enum].join(' | ')}&quot;
      end
    end

    # Array length rules
    array_fields = schema[:properties].select { |k, v| v[:type] == 'array' &amp;&amp; v[:maxItems] }
    if array_fields.any?
      rules &lt;&lt; &quot;\nArray length limits:&quot;
      array_fields.each do |field, field_schema|
        rules &lt;&lt; &quot;- #{field}: maximum #{field_schema[:maxItems]} items&quot;
      end
    end

    # Required field reminders
    if schema[:required]&amp;.any?
      rules &lt;&lt; &quot;\nRequired fields (cannot be null or empty):&quot;
      rules &lt;&lt; &quot;- #{schema[:required].join(', ')}&quot;
    end

    rules.join(&quot;\n&quot;)
  end

  def self.build_validation_reminders(schema)
    &lt;&lt;~REMINDERS
      ## Pre-submission Checklist

      Before returning your response, verify:
       All required fields are present and non-empty
       Enum values match exactly (check spelling and case)
       Arrays don't exceed maximum item limits
       JSON is valid and properly formatted
       Field types match schema requirements
       No additional fields outside the schema
    REMINDERS
  end
end
</code></pre>
<h4 id="multi-language-support">Multi-Language Support</h4>
<pre><code class="language-ruby">class MultiLanguagePromptBuilder &lt; SchemaAwarePromptBuilder
  LANGUAGE_INSTRUCTIONS = {
    'es' =&gt; {
      system_instruction: &quot;Eres un analista experto en contenido especializado en extraer metadatos estructurados de documentos.&quot;,
      focus_keywords: &quot;Extrae palabras clave relevantes y especficas en espaol&quot;,
      summary_instruction: &quot;Crea un resumen conciso e informativo en espaol&quot;
    },
    'fr' =&gt; {
      system_instruction: &quot;Vous tes un analyste de contenu expert spcialis dans l'extraction de mtadonnes structures de documents.&quot;,
      focus_keywords: &quot;Extraire des mots-cls pertinents et spcifiques en franais&quot;,
      summary_instruction: &quot;Crer un rsum concis et informatif en franais&quot;
    },
    'de' =&gt; {
      system_instruction: &quot;Sie sind ein Experte fr Inhaltsanalyse, der auf die Extraktion strukturierter Metadaten aus Dokumenten spezialisiert ist.&quot;,
      focus_keywords: &quot;Extrahieren Sie relevante und spezifische Schlsselwrter auf Deutsch&quot;,
      summary_instruction: &quot;Erstellen Sie eine prgnante und informative Zusammenfassung auf Deutsch&quot;
    }
  }.freeze

  def build_prompt(content, schema, language = 'en')
    if language == 'en'
      super(content, schema)
    else
      build_multilingual_prompt(content, schema, language)
    end
  end

  private

  def build_multilingual_prompt(content, schema, language)
    instructions = LANGUAGE_INSTRUCTIONS[language] || LANGUAGE_INSTRUCTIONS['en']

    prompt_parts = [
      instructions[:system_instruction],
      build_schema_specification(schema),
      build_content_context(content),
      build_language_specific_instructions(language, instructions),
      build_final_instruction(schema)
    ]

    prompt_parts.join(&quot;\n\n&quot;)
  end

  def build_language_specific_instructions(language, instructions)
    &lt;&lt;~INSTRUCTIONS
      ## Language-Specific Requirements

      - Content language: #{language.upcase}
      - #{instructions[:summary_instruction]}
      - #{instructions[:focus_keywords]}
      - Maintain cultural context and terminology appropriate for #{language.upcase}
      - Use native language conventions for formatting and style
    INSTRUCTIONS
  end
end
</code></pre>
<hr />
<p><em>This document is part of the Ragdoll documentation suite. For immediate help, see the <a href="../quick-start/">Quick Start Guide</a> or <a href="../api-client/">API Reference</a>.</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>